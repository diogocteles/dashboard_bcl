<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BioCollabs Analytics Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="data.js"></script>
<style>
:root{
  --bg:#080e1a;--surface:#0f1929;--card:#131f30;--card-h:#182538;
  --border:rgba(255,255,255,0.06);--border-b:rgba(255,255,255,0.12);
  --text:#e2eaf5;--muted:#6b8199;--dim:#3d5570;
  --green:#00e5a0;--green-d:rgba(0,229,160,0.12);--green-m:rgba(0,229,160,0.4);
  --blue:#3b9eff;--blue-d:rgba(59,158,255,0.12);
  --rose:#ff4d6d;--rose-d:rgba(255,77,109,0.12);
  --amber:#ffb347;--amber-d:rgba(255,179,71,0.12);
  --purple:#a78bfa;--purple-d:rgba(167,139,250,0.12);
  --cyan:#22d3ee;--cyan-d:rgba(34,211,238,0.12);
  --sw:240px;--hh:56px;--r:12px;--rs:8px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth;font-size:14px}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;line-height:1.5;overflow-x:hidden}
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border-b);border-radius:4px}

/* HEADER */
header{position:fixed;top:0;left:0;right:0;height:var(--hh);background:rgba(8,14,26,0.97);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 20px 0 calc(var(--sw)+20px);z-index:100;gap:12px}
.h-logo{font-family:'Syne',sans-serif;font-weight:800;font-size:15px;letter-spacing:-0.3px;display:flex;align-items:center;gap:8px}
.h-dot{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 10px var(--green);animation:pdot 2s ease-in-out infinite}
@keyframes pdot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.8)}}
.h-meta{display:flex;align-items:center;gap:8px;margin-left:auto}
.badge{font-family:'DM Mono',monospace;font-size:11px;padding:3px 9px;border-radius:100px;border:1px solid var(--border-b);color:var(--muted);background:rgba(255,255,255,0.03)}
.badge.live{border-color:var(--green-m);color:var(--green);background:var(--green-d)}
.badge.active-filter{border-color:rgba(59,158,255,0.5);color:var(--blue);background:var(--blue-d)}

/* COUNTRY FILTER */
.country-filter{display:flex;align-items:center;gap:6px}
.cf-label{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);letter-spacing:0.5px}
.cf-select{background:rgba(255,255,255,0.05);border:1px solid var(--border-b);color:var(--text);font-family:'DM Sans',sans-serif;font-size:12px;padding:5px 28px 5px 10px;border-radius:8px;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%236b8199'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;transition:border-color .2s}
.cf-select:focus{outline:none;border-color:var(--blue)}
.cf-select:hover{border-color:var(--border-b)}

/* SIDEBAR */
aside{position:fixed;top:var(--hh);left:0;bottom:0;width:var(--sw);background:rgba(8,14,26,0.85);border-right:1px solid var(--border);overflow-y:auto;padding:16px 10px;z-index:90;backdrop-filter:blur(10px)}
.nl{font-family:'DM Mono',monospace;font-size:10px;font-weight:500;letter-spacing:1.5px;text-transform:uppercase;color:var(--dim);padding:0 10px;margin:4px 0 6px}
.ni{display:flex;align-items:center;gap:9px;padding:8px 10px;border-radius:var(--rs);cursor:pointer;transition:all .2s;color:var(--muted);font-size:12.5px;text-decoration:none;margin-bottom:1px;position:relative}
.ni:hover{color:var(--text);background:rgba(255,255,255,0.04)}
.ni.active{color:var(--green);background:var(--green-d)}
.ni.active::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:2px;height:55%;border-radius:0 2px 2px 0;background:var(--green)}
.ni .ic{font-size:13px;opacity:.7;flex-shrink:0}
.ni.active .ic{opacity:1}
.ndiv{height:1px;background:var(--border);margin:10px 0}
.s-stat{padding:12px;background:var(--green-d);border-radius:8px;border:1px solid var(--green-m);margin-top:8px}
.s-stat .sv{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;color:var(--green);letter-spacing:-0.5px;margin:4px 0 2px}

/* MAIN */
main{margin-left:var(--sw);margin-top:var(--hh);padding:28px 28px 60px}
.section{margin-bottom:56px;scroll-margin-top:calc(var(--hh)+20px)}
.s-eye{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--dim);margin-bottom:5px}
.s-title{font-family:'Syne',sans-serif;font-size:21px;font-weight:700;color:var(--text);letter-spacing:-0.5px;margin-bottom:5px}
.s-sub{font-size:12.5px;color:var(--muted);line-height:1.6;margin-bottom:18px}

/* INSIGHTS */
.ins-row{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:20px}
.ins{display:flex;align-items:center;gap:5px;font-size:12px;font-weight:500;padding:5px 11px;border-radius:100px;border:1px solid;letter-spacing:-0.1px}
.ins.g{color:var(--green);border-color:var(--green-m);background:var(--green-d)}
.ins.r{color:var(--rose);border-color:rgba(255,77,109,0.3);background:var(--rose-d)}
.ins.b{color:var(--blue);border-color:rgba(59,158,255,0.3);background:var(--blue-d)}
.ins.a{color:var(--amber);border-color:rgba(255,179,71,0.3);background:var(--amber-d)}
.ins.p{color:var(--purple);border-color:rgba(167,139,250,0.3);background:var(--purple-d)}

/* KPI GRID */
.kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px}
.kpi{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:18px;position:relative;overflow:hidden;transition:border-color .2s,transform .2s}
.kpi:hover{border-color:var(--border-b);transform:translateY(-1px)}
.kpi::after{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.07),transparent)}
.kl{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:1px;text-transform:uppercase;color:var(--muted);margin-bottom:9px}
.kv{font-family:'Syne',sans-serif;font-size:24px;font-weight:700;letter-spacing:-1px;color:var(--text);line-height:1;margin-bottom:7px}
.kv.g{color:var(--green)}.kv.b{color:var(--blue)}
.kt{display:flex;align-items:center;gap:4px;font-size:11px;font-weight:500}
.kt.up{color:var(--green)}.kt.dn{color:var(--rose)}.kt.n{color:var(--muted)}
.kglow{position:absolute;bottom:-20px;right:-20px;width:70px;height:70px;border-radius:50%;opacity:.06}
.kglow.g{background:var(--green)}.kglow.b{background:var(--blue)}.kglow.r{background:var(--rose)}.kglow.a{background:var(--amber)}

/* GRIDS */
.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.g3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.g12{display:grid;grid-template-columns:1fr 2fr;gap:14px}
.g21{display:grid;grid-template-columns:2fr 1fr;gap:14px}
.g13{display:grid;grid-template-columns:1fr 3fr;gap:14px}
.mb14{margin-bottom:14px}

/* CARD */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:18px 18px 14px;position:relative;overflow:hidden}
.card:hover{border-color:var(--border-b)}
.card-h{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px;gap:10px}
.card-title{font-family:'Syne',sans-serif;font-size:13.5px;font-weight:600;color:var(--text);letter-spacing:-0.2px}
.card-sub{font-size:11px;color:var(--muted);margin-top:3px}
.cleg{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
.leg-i{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--muted)}
.leg-d{width:8px;height:8px;border-radius:2px;flex-shrink:0}

/* STAT ROW */
.sr{display:flex;align-items:center;justify-content:space-between;padding:9px 0;border-bottom:1px solid var(--border)}
.sr:last-child{border-bottom:none}
.sn{font-size:12.5px;color:var(--muted)}.sv{font-family:'DM Mono',monospace;font-size:12.5px;font-weight:500;color:var(--text)}
.tag-sm{display:inline-flex;align-items:center;font-family:'DM Mono',monospace;font-size:10px;padding:2px 6px;border-radius:4px;background:rgba(255,255,255,0.06);color:var(--muted)}
.tag-sm.g{background:var(--green-d);color:var(--green)}.tag-sm.r{background:var(--rose-d);color:var(--rose)}.tag-sm.b{background:var(--blue-d);color:var(--blue)}.tag-sm.a{background:var(--amber-d);color:var(--amber)}

/* FILTER TABS */
.ftabs{display:flex;gap:4px;flex-wrap:wrap}
.ftab{font-family:'DM Mono',monospace;font-size:10px;font-weight:500;letter-spacing:0.5px;padding:4px 10px;border-radius:6px;border:1px solid var(--border-b);color:var(--muted);background:transparent;cursor:pointer;transition:all .15s}
.ftab:hover{color:var(--text);border-color:var(--border-b);background:rgba(255,255,255,0.04)}
.ftab.active{color:var(--green);border-color:var(--green-m);background:var(--green-d)}
.ftab.active-b{color:var(--blue);border-color:rgba(59,158,255,.4);background:var(--blue-d)}

/* FUNNEL */
.fstep{display:flex;align-items:center;gap:14px;margin-bottom:9px}
.flab{width:180px;flex-shrink:0;font-size:12px;color:var(--muted)}
.fbar-w{flex:1;height:34px;background:rgba(255,255,255,0.04);border-radius:4px;overflow:hidden;position:relative}
.fbar{height:100%;border-radius:4px;display:flex;align-items:center;padding:0 10px;font-family:'DM Mono',monospace;font-size:11px;font-weight:500;color:rgba(255,255,255,.9);white-space:nowrap}
.fpct{width:55px;flex-shrink:0;font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);text-align:right}

/* TABLE */
.tbl-wrap{overflow-x:auto;border-radius:var(--rs);border:1px solid var(--border)}
table{width:100%;border-collapse:collapse;font-size:12px}
thead tr{background:rgba(255,255,255,0.03);border-bottom:1px solid var(--border)}
th{font-family:'DM Mono',monospace;font-size:10px;font-weight:500;letter-spacing:0.8px;text-transform:uppercase;color:var(--muted);padding:9px 12px;text-align:left;white-space:nowrap;cursor:pointer;user-select:none}
th:hover{color:var(--text)}
th.sorted{color:var(--green)}
td{padding:8px 12px;border-bottom:1px solid var(--border);color:var(--text);white-space:nowrap}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,0.02)}
.td-mono{font-family:'DM Mono',monospace}
.td-pill{display:inline-flex;align-items:center;padding:2px 7px;border-radius:4px;font-family:'DM Mono',monospace;font-size:10px}

/* COHORT TABLE */
.cohort-wrap{overflow-x:auto}
.cohort{border-collapse:collapse;font-size:11px;min-width:100%}
.cohort th{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:0.8px;text-transform:uppercase;color:var(--muted);padding:7px 10px;text-align:right;white-space:nowrap;background:rgba(255,255,255,0.02);border-bottom:1px solid var(--border);border-right:1px solid var(--border)}
.cohort th:first-child{text-align:left;min-width:120px;position:sticky;left:0;z-index:2;background:var(--card)}
.cohort td{padding:7px 10px;text-align:right;font-family:'DM Mono',monospace;border-bottom:1px solid var(--border);border-right:1px solid var(--border);transition:background .2s;min-width:80px}
.cohort td:first-child{text-align:left;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:500;color:var(--text);position:sticky;left:0;z-index:1;background:var(--card)}
.cohort tr:last-child td{border-bottom:none}

/* COUNTRY TABLE */
.ctry-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px}
.ctry-card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:16px;cursor:pointer;transition:all .2s}
.ctry-card:hover,.ctry-card.sel{border-color:var(--border-b)}
.ctry-card.sel{background:rgba(59,158,255,0.06);border-color:rgba(59,158,255,0.4)}
.ctry-flag{font-size:20px;margin-bottom:8px}
.ctry-name{font-family:'Syne',sans-serif;font-weight:700;font-size:14px;margin-bottom:10px}
.ctry-row{display:flex;justify-content:space-between;margin-bottom:4px}
.ctry-k{font-size:11px;color:var(--muted)}.ctry-v{font-family:'DM Mono',monospace;font-size:11px;font-weight:500}

/* METRIC TOGGLE */
.mtog{display:flex;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:8px;padding:3px;gap:2px}
.mtog-btn{font-size:11px;font-weight:500;padding:4px 12px;border-radius:5px;border:none;background:transparent;color:var(--muted);cursor:pointer;transition:all .15s}
.mtog-btn.active{background:var(--card);color:var(--text);box-shadow:0 1px 4px rgba(0,0,0,0.3)}

/* ANIMATIONS */
.fi{opacity:0;transform:translateY(12px);animation:fiu .4s ease forwards}
@keyframes fiu{to{opacity:1;transform:translateY(0)}}
.kpi:nth-child(1){animation-delay:.05s}.kpi:nth-child(2){animation-delay:.1s}.kpi:nth-child(3){animation-delay:.15s}.kpi:nth-child(4){animation-delay:.2s}.kpi:nth-child(5){animation-delay:.25s}.kpi:nth-child(6){animation-delay:.3s}.kpi:nth-child(7){animation-delay:.35s}.kpi:nth-child(8){animation-delay:.4s}

@media(max-width:1100px){.kpi-grid{grid-template-columns:repeat(3,1fr)}.g3{grid-template-columns:1fr 1fr}}
@media(max-width:800px){:root{--sw:0px}aside{display:none}header{padding-left:20px}.kpi-grid,.g2,.g3,.g12,.g21{grid-template-columns:1fr}}

/* AUTH GATE */
#auth-gate{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:var(--bg);backdrop-filter:blur(0px)}
#auth-gate::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 60% 50% at 50% 40%,rgba(0,229,160,0.06) 0%,transparent 70%)}
.auth-box{position:relative;width:360px;background:var(--card);border:1px solid var(--border-b);border-radius:16px;padding:40px 36px;display:flex;flex-direction:column;align-items:center;gap:24px;box-shadow:0 32px 80px rgba(0,0,0,0.6)}
.auth-logo{font-family:'Syne',sans-serif;font-weight:800;font-size:22px;letter-spacing:-0.5px;display:flex;align-items:center;gap:10px}
.auth-dot{width:10px;height:10px;border-radius:50%;background:var(--green);box-shadow:0 0 18px var(--green);animation:pdot 2s ease-in-out infinite}
.auth-sub{font-family:'DM Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-top:-14px}
.auth-field{width:100%;position:relative}
.auth-field input{width:100%;background:rgba(255,255,255,0.04);border:1px solid var(--border-b);border-radius:10px;color:var(--text);font-family:'DM Mono',monospace;font-size:14px;letter-spacing:2px;padding:13px 44px 13px 16px;outline:none;transition:border-color .2s}
.auth-field input::placeholder{letter-spacing:0;color:var(--dim);font-size:12px}
.auth-field input:focus{border-color:var(--green)}
.auth-eye{position:absolute;right:12px;top:50%;transform:translateY(-50%);cursor:pointer;color:var(--muted);font-size:16px;user-select:none;transition:color .15s}
.auth-eye:hover{color:var(--text)}
.auth-btn{width:100%;padding:13px;background:var(--green);color:#061410;font-family:'Syne',sans-serif;font-weight:700;font-size:14px;letter-spacing:0.3px;border:none;border-radius:10px;cursor:pointer;transition:opacity .15s,transform .1s}
.auth-btn:hover{opacity:.88}
.auth-btn:active{transform:scale(.98)}
.auth-err{font-family:'DM Mono',monospace;font-size:11px;color:var(--rose);opacity:0;transition:opacity .2s;height:14px}
.auth-err.show{opacity:1}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-5px)}80%{transform:translateX(5px)}}
.auth-box.shake{animation:shake .35s ease}
@keyframes auth-fade{to{opacity:0;pointer-events:none}}
.global-chip{display:inline-flex;align-items:center;gap:4px;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:0.3px;padding:2px 8px;border-radius:100px;border:1px solid var(--border-b);color:var(--dim);background:rgba(255,255,255,0.02);margin-top:6px;white-space:nowrap}
.wt-wrap{overflow-x:auto;overflow-y:auto;max-height:460px;border-radius:8px;border:1px solid var(--border-b)}
.wt-tbl{border-collapse:collapse;font-size:11px;font-family:'DM Mono',monospace;white-space:nowrap;width:100%}
.wt-tbl thead tr:first-child th{position:sticky;top:0;z-index:3;background:#0e1f1b;padding:7px 10px;border-bottom:1px solid var(--border-b);font-size:10px;letter-spacing:0.4px;color:var(--dim);text-align:center}
.wt-tbl thead tr:nth-child(2) th{position:sticky;top:28px;z-index:3;background:#0c1b18;padding:5px 8px;border-bottom:2px solid var(--border-b);font-size:9px;color:rgba(255,255,255,0.3);text-align:right;letter-spacing:0.2px}
.wt-tbl thead th.wt-sticky,.wt-tbl tbody td.wt-sticky{position:sticky;left:0;z-index:4;background:var(--card-bg)}
.wt-tbl thead tr:first-child th.wt-sticky{z-index:5;background:#0e1f1b}
.wt-tbl thead tr:nth-child(2) th.wt-sticky{z-index:5;background:#0c1b18;text-align:left}
.wt-tbl tbody td{padding:5px 10px;border-bottom:1px solid rgba(255,255,255,0.025);text-align:right;color:var(--muted)}
.wt-tbl tbody td.wt-sticky{color:var(--text);font-size:10px;padding-right:14px;border-right:1px solid var(--border-b);min-width:88px}
.wt-tbl tbody td.wt-na{color:rgba(255,255,255,0.15);text-align:right}
.wt-tbl tbody td.wt-rev{color:var(--green)}
.wt-tbl .wt-grp-h{border-left:1px solid var(--border-b)}
.wt-tbl .wt-grp-h.c-paid{color:#3b9eff} .wt-tbl .wt-grp-h.c-email{color:#a78bfa} .wt-tbl .wt-grp-h.c-sms{color:#34d399}
.wt-tbl .wt-grp-h.c-flow{color:#fb923c} .wt-tbl .wt-grp-h.c-none{color:var(--dim)} .wt-tbl .wt-grp-h.c-total{color:var(--green)}
.wt-tbl tbody td.wt-gl{border-left:1px solid rgba(255,255,255,0.04)}
.wt-tbl tbody tr:hover td{background:rgba(255,255,255,0.02)}
.wt-tbl tbody tr:hover td.wt-sticky{background:var(--card-bg)}
#auth-gate.fade-out{animation:auth-fade .5s ease forwards}
</style>
</head>
<body>

<!-- AUTH GATE -->
<div id="auth-gate">
  <div class="auth-box" id="auth-box">
    <div class="auth-logo"><div class="auth-dot"></div>BioCollabs</div>
    <div class="auth-sub">Analytics Dashboard</div>
    <div class="auth-field">
      <input type="password" id="auth-input" placeholder="Enter password" autocomplete="current-password" onkeydown="if(event.key==='Enter')checkAuth()">
      <span class="auth-eye" id="auth-eye" onclick="togglePw()">ğŸ‘</span>
    </div>
    <div class="auth-err" id="auth-err">Incorrect password â€” try again</div>
    <button class="auth-btn" onclick="checkAuth()">Access Dashboard</button>
  </div>
</div>


<header>
  <div class="h-logo"><div class="h-dot"></div>BioCollabs Analytics</div>
  <div class="country-filter">
    <span class="cf-label">MARKET</span>
    <select class="cf-select" id="countryFilter" onchange="setCountry(this.value)">
      <option value="ALL">ğŸŒ All Markets</option>
      <option value="US">ğŸ‡ºğŸ‡¸ United States</option>
      <option value="GB">ğŸ‡¬ğŸ‡§ United Kingdom</option>
      <option value="DE">ğŸ‡©ğŸ‡ª Germany</option>
      <option value="NL">ğŸ‡³ğŸ‡± Netherlands</option>
      <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
    </select>
  </div>
  <div class="h-meta">
    <span class="badge" id="filterBadge" style="display:none"></span>
    <span class="badge">Data: Mar 2020 â€“ Feb 2026</span>
    <span class="badge live">â— Feb 18, 2026</span>
  </div>
</header>

<aside id="sidebar">
  <div class="nl">Navigation</div>
  <a class="ni active" href="#overview"><span class="ic">â¬¡</span> Overview</a>
  <a class="ni" href="#country"><span class="ic">ğŸŒ</span> Country Breakdown</a>
  <a class="ni" href="#revenue"><span class="ic">â—ˆ</span> Revenue Trends</a>
  <a class="ni" href="#orders"><span class="ic">â—‰</span> Orders & Customers</a>
  <a class="ni" href="#subscriptions"><span class="ic">â—</span> Subscriptions</a>
  <div class="ndiv"></div>
  <a class="ni" href="#attribution"><span class="ic">â—ˆ</span> Marketing Attribution</a>
  <a class="ni" href="#cohort"><span class="ic">â–¦</span> Cohort Analysis</a>
  <a class="ni" href="#funnel"><span class="ic">â–½</span> Conversion Funnel</a>
  <a class="ni" href="#retention"><span class="ic">â—‘</span> Retention & Health</a>
  <div class="ndiv"></div>
  <div class="s-stat">
    <div style="font-family:'DM Mono',monospace;font-size:9px;letter-spacing:1px;color:var(--green)">TOTAL REVENUE</div>
    <div class="sv" id="sb-rev">$29.2M</div>
    <div style="font-size:11px;color:var(--muted)" id="sb-orders">462,190 orders</div>
  </div>
</aside>

<main>

<!-- â•â• OVERVIEW â•â• -->
<section class="section" id="overview">
  <div class="s-eye">01 / Overview</div>
  <div class="s-title">Performance Snapshot <span id="country-tag" style="font-size:14px;font-weight:400;color:var(--muted)"></span></div>
  <div class="s-sub" id="overview-sub">US, UK, Germany, Netherlands &amp; Canada Â· Fulfilled orders Â· Mar 2020 â€“ Feb 2026</div>
  <div class="ins-row">
    <span class="ins g">â†‘ $29.2M gross revenue Â· 5-market focus</span>
    <span class="ins b">67.4% returning customer rate</span>
    <span class="ins a">â†‘ 98.7% subscription order share</span>
    <span class="ins r">â†“ Returns &amp; discounts rising in 2024</span>
  </div>
  <div class="kpi-grid">
    <div class="kpi fi"><div class="kl">Total Gross Revenue</div><div class="kv g" id="k-rev">$29.2M</div><div class="kt up" id="k-rev-t">â†‘ Peak Oct 2024 at $3.0M/mo</div><div class="kglow g"></div></div>
    <div class="kpi fi"><div class="kl">Total Orders</div><div class="kv" id="k-ord">462,190</div><div class="kt up" id="k-ord-t">â†‘ 98.7% subscription order share</div><div class="kglow b"></div></div>
    <div class="kpi fi"><div class="kl">New Customers</div><div class="kv b" id="k-new">150,871</div><div class="kt n" id="k-new-t">32.6% of all customers</div><div class="kglow b"></div></div>
    <div class="kpi fi"><div class="kl">Returning Customers</div><div class="kv" id="k-ret">311,319</div><div class="kt up" id="k-ret-t">â†‘ 67.4% of customer base</div><div class="kglow g"></div></div>
    <div class="kpi fi"><div class="kl">Avg Order Value</div><div class="kv" id="k-aov">$63.07</div><div class="kt up">â†‘ Store AOV $71 Â· Sub AOV $57</div><div class="kglow a"></div></div>
    <div class="kpi fi"><div class="kl">Returning Customer Rate</div><div class="kv g" id="k-rr">67.4%</div><div class="kt up">â†‘ Strong retention signal</div><div class="kglow g"></div></div>
    <div class="kpi fi"><div class="kl">Discount Rate</div><div class="kv" id="k-dr">4.4%</div><div class="kt a" id="k-dr-t">â†‘ Rising in 2024â€“2025 Â· 4.4%</div><div class="kglow a"></div></div>
    <div class="kpi fi"><div class="kl">Return Rate</div><div class="kv" id="k-rtr">3.3%</div><div class="kt up" id="k-rtr-t">â†‘ 3.3% Â· rising â€” monitor</div><div class="kglow r"></div></div>
  </div>
</section>

<!-- â•â• COUNTRY BREAKDOWN â•â• -->
<section class="section" id="country">
  <div class="s-eye">02 / Country</div>
  <div class="s-title">Country / Market Breakdown</div>
  <div class="s-sub">Click a market card to filter the entire dashboard Â· Focus: US, UK, Germany, Netherlands, Canada</div>
  <div class="ins-row">
    <span class="ins g">US = 93.6% of all orders Â· 5 markets</span>
    <span class="ins b">UK highest retention rate (84.8%)</span>
    <span class="ins a">DE &amp; NL highest AOV ($73â€“$77)</span>
    <span class="ins r">CA highest AOV ($98.61) Â· growing market</span>
  </div>
  <div class="ctry-grid" id="ctry-grid"></div>
</section>

<!-- â•â• REVENUE â•â• -->
<section class="section" id="revenue">
  <div class="s-eye">03 / Revenue</div>
  <div class="s-title">Revenue Trends</div>
  <div class="s-sub">Monthly gross & net sales from launch through Feb 2026 Â· 72-month view</div>
  <div class="ins-row">
    <span class="ins g">â†‘ 43Ã— growth from 2020 to Oct 2024 peak</span>
    <span class="ins r">â†“ Post-peak decline from Dec 2024</span>
    <span class="ins b">Feb 2023 spike: $1.3M promo event</span>
    <span class="ins a">Returns & discounts rising proportionally</span>
  </div>
  <div class="card mb14">
    <div class="card-h"><div><div class="card-title">Monthly Gross vs Net Sales</div><div class="card-sub" id="rev-chart-sub">Full history Â· Mar 2020 â€“ Feb 2026 Â· 5 markets</div></div></div>
    <div style="height:260px;position:relative"><canvas id="revenueChart"></canvas></div>
    <div class="cleg"><div class="leg-i"><div class="leg-d" style="background:#00e5a0"></div>Gross Sales</div><div class="leg-i"><div class="leg-d" style="background:#3b9eff"></div>Net Sales</div></div>
  </div>
  <div class="g2">
    <div class="card">
      <div class="card-h"><div><div class="card-title">Discounts & Returns Over Time</div><div class="card-sub">Monthly $ Â· 2023 onwards</div></div></div>
      <div style="height:200px;position:relative"><canvas id="discReturnsChart"></canvas></div>
      <div class="cleg"><div class="leg-i"><div class="leg-d" style="background:#ff4d6d"></div>Returns</div><div class="leg-i"><div class="leg-d" style="background:#ffb347"></div>Discounts</div></div>
    </div>
    <div class="card">
      <div class="card-h"><div><div class="card-title">Revenue Quality Metrics</div><div class="card-sub">All-time totals</div><span class="global-chip">ğŸŒ Global Â· not filtered by country</span></div></div>
      <div class="sr"><span class="sn">Gross Sales</span><span class="sv" style="color:var(--green)">$29,152,863</span></div>
      <div class="sr"><span class="sn">Net Sales</span><span class="sv">$26,929,950</span></div>
      <div class="sr"><span class="sn">Total Discounts</span><span class="sv" style="color:var(--amber)">âˆ’$1,273,035</span></div>
      <div class="sr"><span class="sn">Total Returns</span><span class="sv" style="color:var(--rose)">âˆ’$949,875</span></div>
      <div class="sr"><span class="sn">Total Shipping Revenue</span><span class="sv">$1,851,087</span></div>
      <div class="sr"><span class="sn">Discount Rate</span><span class="sv" style="color:var(--amber)">4.37%</span></div>
      <div class="sr"><span class="sn">Return Rate</span><span class="sv" style="color:var(--rose)">3.26%</span></div>
    </div>
  </div>
</section>

<!-- â•â• ORDERS & CUSTOMERS â•â• -->
<section class="section" id="orders">
  <div class="s-eye">04 / Orders</div>
  <div class="s-title">Orders & Customer Acquisition</div>
  <div class="s-sub">Monthly order volume, new vs returning split, and AOV trends</div>
  <div class="ins-row">
    <span class="ins g">â†‘ Peak Oct 2024: 27,659 orders</span>
    <span class="ins b">Returning 2.1Ã— new customers consistently</span>
    <span class="ins r">â†“ Gradual decline into late 2025</span>
    <span class="ins a">AOV $63 avg Â· CA peak $98.61</span>
  </div>
  <div class="card mb14">
    <div class="card-h"><div><div class="card-title">New vs Returning Customers Per Month</div><div class="card-sub">Jan 2023 â€“ Feb 2026</div></div></div>
    <div style="height:240px;position:relative"><canvas id="custChart"></canvas></div>
    <div class="cleg"><div class="leg-i"><div class="leg-d" style="background:#00e5a0"></div>New Customers</div><div class="leg-i"><div class="leg-d" style="background:#3b9eff;opacity:.7"></div>Returning Customers</div></div>
  </div>
  <div class="g2">
    <div class="card">
      <div class="card-h"><div><div class="card-title">Monthly Order Volume</div><div class="card-sub">Total orders per month Â· 2023â€“2026</div></div></div>
      <div style="height:200px;position:relative"><canvas id="ordVolChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-h"><div><div class="card-title">Average Order Value Trend</div><div class="card-sub">AOV derived from gross Ã· orders</div></div></div>
      <div style="height:200px;position:relative"><canvas id="aovChart"></canvas></div>
    </div>
  </div>
</section>

<!-- â•â• SUBSCRIPTIONS â•â• -->
<section class="section" id="subscriptions">
  <div class="s-eye">05 / Subscriptions</div>
  <div class="s-title">Subscription Analysis</div>
  <div class="s-sub">Growth of recurring revenue â€” 98.7% of all orders are subscriptions Â· 177K unique first-time subscribers acquired all-time</div>
  <div class="ins-row">
    <span class="ins g">â†‘ Sub share 70% of all orders</span>
    <span class="ins b">177,056 first-time subscribers acquired</span>
    <span class="ins a">~65% churn from Order #1 â†’ #2</span>
    <span class="ins r">One-time orders declining as share</span>
  </div>
  <div class="card mb14">
    <div class="card-h"><div><div class="card-title">New vs Renewal Subscription Orders</div><div class="card-sub">Monthly split Â· 2023â€“2026 Â· New = first-time subscribers, Renewal = recurring charges</div></div></div>
    <div style="height:240px;position:relative"><canvas id="subMixChart"></canvas></div>
    <div class="cleg"><div class="leg-i"><div class="leg-d" style="background:#00e5a0"></div>Subscription</div><div class="leg-i"><div class="leg-d" style="background:#3b9eff;opacity:.6"></div>One-Time</div></div>
  </div>
  <div class="g2">
    <div class="card">
      <div class="card-h"><div><div class="card-title">Overall Order Type Split</div><div class="card-sub">All-time Â· sub vs one-time</div></div></div>
      <div style="height:200px;position:relative"><canvas id="subDonutChart"></canvas></div>
    </div>
    <div class="card">
      <div class="card-h"><div><div class="card-title">Subscription Retention Funnel</div><div class="card-sub">Orders by sequence number</div></div></div>
      <div style="height:200px;position:relative"><canvas id="subRetChart"></canvas></div>
    </div>
  </div>
</section>

<!-- â•â• MARKETING ATTRIBUTION â•â• -->
<section class="section" id="attribution">
  <div class="s-eye">07 / Attribution</div>
  <div class="s-title">Marketing Attribution</div>
  <div class="s-sub">Revenue, CVR and weekly trends by UTM medium and traffic source Â· last 30 weeks highlighted</div>
  <div class="ins-row">
    <span class="ins g">â†‘ Flow automation: 7.89% CVR â€” best channel</span>
    <span class="ins b">Paid drives $8M revenue but lowest CVR (2.63%)</span>
    <span class="ins a">Email & SMS: 5â€“6% CVR + strong revenue</span>
    <span class="ins r">â†“ All channels CVR declining in early 2026</span>
  </div>

  <!-- WoW CVR by Medium -->
  <div class="card mb14">
    <div class="card-h">
      <div><div class="card-title">Weekly CVR Trend by UTM Medium</div><div class="card-sub">Jul 2025 â€“ Feb 2026 Â· sessions with min 20/week shown</div><span class="global-chip">ğŸŒ Global Â· not filtered by country</span></div>
      <div class="ftabs" id="med-tabs">
        <button class="ftab active" onclick="filterMedChart('ALL',this)">All</button>
        <button class="ftab" onclick="filterMedChart('paid',this)">Paid</button>
        <button class="ftab" onclick="filterMedChart('none',this)">Direct/None</button>
        <button class="ftab" onclick="filterMedChart('email',this)">Email</button>
        <button class="ftab" onclick="filterMedChart('sms',this)">SMS</button>
        <button class="ftab" onclick="filterMedChart('flow',this)">Flow</button>
      </div>
    </div>
    <div style="height:220px;position:relative"><canvas id="wowMedChart"></canvas></div>
    <div class="cleg" id="wow-med-legend"></div>
  </div>

  <!-- WoW Revenue by Medium -->
  <div class="card mb14">
    <div class="card-h">
      <div><div class="card-title">Weekly Revenue Trend by UTM Medium</div><div class="card-sub">Jul 2025 â€“ Feb 2026 Â· from orders data</div><span class="global-chip">ğŸŒ Global Â· not filtered by country</span></div>
      <div class="ftabs" id="rev-med-tabs">
        <button class="ftab active" onclick="filterRevMedChart('ALL',this)">All</button>
        <button class="ftab" onclick="filterRevMedChart('paid',this)">Paid</button>
        <button class="ftab" onclick="filterRevMedChart('none',this)">Direct/None</button>
        <button class="ftab" onclick="filterRevMedChart('email',this)">Email</button>
        <button class="ftab" onclick="filterRevMedChart('sms',this)">SMS</button>
        <button class="ftab" onclick="filterRevMedChart('flow',this)">Flow</button>
      </div>
    </div>
    <div style="height:220px;position:relative"><canvas id="wowRevMedChart"></canvas></div>
    <div class="cleg" id="wow-rev-legend"></div>
  </div>

  <!-- Weekly Traffic by Medium -->
  <div class="card mb14">
    <div class="card-h">
      <div><div class="card-title">Weekly Traffic by Medium</div><div class="card-sub">Jul 2025 â€“ Feb 2026 Â· estimated sessions by UTM medium</div><span class="global-chip">ğŸŒ Global Â· not filtered by country</span></div>
      <div class="ftabs" id="traf-tabs">
        <button class="ftab active" onclick="filterTrafChart('ALL',this)">All</button>
        <button class="ftab" onclick="filterTrafChart('paid',this)">Paid</button>
        <button class="ftab" onclick="filterTrafChart('none',this)">Direct/None</button>
        <button class="ftab" onclick="filterTrafChart('email',this)">Email</button>
        <button class="ftab" onclick="filterTrafChart('sms',this)">SMS</button>
        <button class="ftab" onclick="filterTrafChart('flow',this)">Flow</button>
      </div>
    </div>
    <div style="height:220px;position:relative"><canvas id="wowTrafChart"></canvas></div>
    <div class="cleg" id="wow-traf-legend"></div>
  </div>

  <!-- Weekly Channel Metrics Table -->
  <div class="card mb14">
    <div class="card-h">
      <div><div class="card-title">Weekly Channel Metrics</div><div class="card-sub">Aug 2024 â€“ Feb 2026 Â· all 4 metrics for all 81 weeks Â· Traffic &amp; CVR from Shopify session analytics Â· Orders &amp; Revenue from order data</div><span class="global-chip">ğŸŒ Global Â· not filtered by country</span></div>
    </div>
    <div class="wt-wrap"><table class="wt-tbl" id="weeklyTable"></table></div>
    <div style="margin-top:8px;font-family:'DM Mono',monospace;font-size:10px;color:rgba(255,255,255,0.25);line-height:1.6">
      Direct/None includes subscription renewal orders (no UTM tag). Traffic estimated from Shopify session share data. â€” = not available for that period.
    </div>
  </div>

  <!-- Campaigns Table -->
  <div class="card">
    <div class="card-h">
      <div><div class="card-title">Top Performing Campaigns</div><div class="card-sub">Meaningful campaigns only (â‰¥300 sessions) Â· sorted by completed checkouts Â· click header to sort</div><span class="global-chip">ğŸŒ Global Â· not filtered by country</span></div>
      <div class="mtog">
        <button class="mtog-btn active" onclick="switchCampView('volume',this)">By Volume</button>
        <button class="mtog-btn" onclick="switchCampView('cvr',this)">By CVR</button>
      </div>
    </div>
    <div class="tbl-wrap">
      <table id="campTable">
        <thead>
          <tr>
            <th onclick="sortCamp(0)">Campaign</th>
            <th onclick="sortCamp(1)">Medium</th>
            <th onclick="sortCamp(2)" class="sorted">Sessions â†“</th>
            <th onclick="sortCamp(3)">Cart%</th>
            <th onclick="sortCamp(4)">CVR%</th>
            <th onclick="sortCamp(5)">Completed</th>
            <th onclick="sortCamp(6)">Started</th>
          </tr>
        </thead>
        <tbody id="campTbody"></tbody>
      </table>
    </div>
  </div>
</section>

<!-- â•â• COHORT ANALYSIS â•â• -->
<section class="section" id="cohort">
  <div class="s-eye">08 / Cohort</div>
  <div class="s-title">Retention Cohort Analysis</div>
  <div class="s-sub">Customer acquisition month Ã— subscription order sequence Â· Jan 2023 â€“ Dec 2025 Â· M+0 = first order, M+1 = 2nd subscription order placed, etc.</div>
  <div class="ins-row">
    <span class="ins r">â†“ ~59% churn from M+0 â†’ M+1 across all cohorts</span>
    <span class="ins g">â†‘ 2024 cohorts: strongest M+0 revenue ($224Kâ€“$796K)</span>
    <span class="ins b">M+2 retention averages ~25% of M+0 order volume</span>
    <span class="ins a">Recent months (2025-10+) show incomplete future data</span>
  </div>
  <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:10px">
    <div style="font-family:'Syne',sans-serif;font-size:13px;font-weight:600;color:var(--text)">Metric &amp; View</div>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <div class="mtog" id="cohort-metric-tog">
        <button class="mtog-btn active" onclick="switchCohortMetric('revenue',this)">Revenue ($)</button>
        <button class="mtog-btn" onclick="switchCohortMetric('orders',this)">Orders (#)</button>
      </div>
      <div class="mtog" id="cohort-mode-tog">
        <button class="mtog-btn active" onclick="switchCohortMode('abs',this)">Absolute</button>
        <button class="mtog-btn" onclick="switchCohortMode('pct',this)">% of M+0</button>
      </div>
    </div>
  </div>
  <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:14px">
    <div style="font-family:'DM Mono',monospace;font-size:10px;letter-spacing:1px;text-transform:uppercase;color:var(--dim)">Channel Filter<span id="cohort-chan-note" style="display:none;text-transform:none;letter-spacing:0;margin-left:6px;opacity:0.5"> Â· absolute only</span></div>
    <div class="mtog" id="cohort-channel-tog">
      <button class="mtog-btn active" onclick="switchCohortChannel('all',this)">All</button>
      <button class="mtog-btn" onclick="switchCohortChannel('paid',this)">Paid</button>
      <button class="mtog-btn" onclick="switchCohortChannel('email',this)">Email</button>
      <button class="mtog-btn" onclick="switchCohortChannel('sms',this)">SMS</button>
      <button class="mtog-btn" onclick="switchCohortChannel('flow',this)">Flow</button>
    </div>
  </div>
  <div class="card">
    <div class="card-h"><div><div class="card-title" id="cohort-card-title">Revenue Retention Cohort</div><div class="card-sub" id="cohort-card-sub">Gross sales Â· Jan 2023 â€“ Dec 2025 Â· M+0 = month of first subscription order, M+1 = 1 month later, etc.</div></div></div>
    <div class="cohort-wrap"><table class="cohort" id="cohortTime"></table></div>
  </div>
</section>

<!-- â•â• FUNNEL â•â• -->
<section class="section" id="funnel">
  <div class="s-eye">09 / Conversion</div>
  <div class="s-title">Conversion Funnel</div>
  <div class="s-sub">2-year funnel performance Â· 4.3M sessions Â· Feb 2024 â€“ Feb 2026</div>
  <div class="ins-row">
    <span class="ins r">â†“ CVR trending 3.5% â†’ 2.0% through 2026</span>
    <span class="ins b">8.8% of sessions add to cart</span>
    <span class="ins a">58% abandon at checkout stage</span>
    <span class="ins g">4.3M total sessions analyzed</span>
  </div>
  <div class="card mb14">
    <div class="card-h">
      <div><div class="card-title">Overall Conversion Funnel</div><div class="card-sub" id="funnel-sub">All channels Â· Feb 2024 â€“ Feb 2026</div><span class="global-chip">ğŸŒ Global Â· not filtered by country</span></div>
      <div class="mtog" id="funnel-channel-tog">
        <button class="mtog-btn active" onclick="switchFunnelChannel('all',this)">All</button>
        <button class="mtog-btn" onclick="switchFunnelChannel('paid',this)">Paid</button>
        <button class="mtog-btn" onclick="switchFunnelChannel('email',this)">Email</button>
        <button class="mtog-btn" onclick="switchFunnelChannel('sms',this)">SMS</button>
        <button class="mtog-btn" onclick="switchFunnelChannel('flow',this)">Flow</button>
      </div>
    </div>
    <div id="funnel-bars">
      <div style="padding:8px 0">
        <div class="fstep"><div class="flab">Sessions</div><div class="fbar-w"><div class="fbar" style="width:100%;background:linear-gradient(90deg,#3b9eff,#2563eb)">4,297,348</div></div><div class="fpct">100%</div></div>
        <div class="fstep"><div class="flab">Cart Additions</div><div class="fbar-w"><div class="fbar" style="width:8.8%;background:linear-gradient(90deg,#00e5a0,#059669)">378,566</div></div><div class="fpct">8.8%</div></div>
        <div class="fstep"><div class="flab">Reached Checkout</div><div class="fbar-w"><div class="fbar" style="width:8.1%;background:linear-gradient(90deg,#ffb347,#d97706)">348,532</div></div><div class="fpct">8.1%</div></div>
        <div class="fstep"><div class="flab">Completed</div><div class="fbar-w"><div class="fbar" style="width:3.42%;background:linear-gradient(90deg,#a78bfa,#7c3aed)">146,874</div></div><div class="fpct">3.42%</div></div>
      </div>
      <div class="sr"><span class="sn">Cart â†’ Checkout drop</span><span class="sv" style="color:var(--amber)">8% cart abandonment</span></div>
      <div class="sr"><span class="sn">Checkout â†’ Complete</span><span class="sv" style="color:var(--rose)">58% abandon at checkout</span></div>
      <div class="sr"><span class="sn">Overall CVR</span><span class="sv">3.42%</span></div>
    </div>
  </div>
  <div class="card">
    <div class="card-h"><div><div class="card-title">Weekly CVR Trend + Session Volume</div><div class="card-sub">Last 30 weeks Â· Jul 2025 â€“ Feb 2026</div><span class="global-chip">ğŸŒ Global Â· not filtered by country</span></div><span class="tag-sm r">â†“ âˆ’35% from peak to Feb 2026</span></div>
    <div style="height:210px;position:relative"><canvas id="cvrTrendChart"></canvas></div>
  </div>
</section>

<!-- â•â• RETENTION â•â• -->
<section class="section" id="retention">
  <div class="s-eye">10 / Retention</div>
  <div class="s-title">Retention & Email Marketing</div>
  <div class="s-sub">Email list health, subscriber growth, and engagement metrics Â· 519K total contacts Â· 277K active</div>
  <div class="ins-row">
    <span class="ins g">â†‘ 3.3% return rate Â· rising in 2024â€“2025</span>
    <span class="ins r">43% of customers unsubscribed from email</span>
    <span class="ins b">100% fulfilled Â· cancellations excluded Â· all years</span>
    <span class="ins a">Discounts 3.6% Â· well controlled</span>
  </div>
  <div class="kpi-grid" style="margin-bottom:14px">
    <div class="kpi"><div class="kl">Total List Size</div><div class="kv">519,925</div><div class="kt n">All customers ever</div><div class="kglow g"></div></div>
    <div class="kpi"><div class="kl">Active Subscribers</div><div class="kv g">53.3%</div><div class="kt up">â†‘ 277,357 contacts</div><div class="kglow g"></div></div>
    <div class="kpi"><div class="kl">Unsubscribed</div><div class="kv" style="color:var(--rose)">40.8%</div><div class="kt dn">212,377 opted out</div><div class="kglow r"></div></div>
    <div class="kpi"><div class="kl">Not Subscribed</div><div class="kv" style="color:var(--muted)">5.8%</div><div class="kt n">30,191 contacts</div><div class="kglow a"></div></div>
  </div>
  <div class="g2 mb14">
    <div class="card">
      <div class="card-h"><div><div class="card-title">Email List Status</div><div class="card-sub">Subscriber breakdown Â· all customers</div><span class="global-chip">ğŸŒ Global Â· not filtered by country</span></div></div>
      <div style="height:180px;position:relative"><canvas id="emailChart"></canvas></div>
      <div class="sr"><span class="sn">Subscribed</span><span class="sv" style="color:var(--green)">277,357</span></div>
      <div class="sr"><span class="sn">Unsubscribed</span><span class="sv" style="color:var(--rose)">212,377</span></div>
      <div class="sr"><span class="sn">Not Subscribed</span><span class="sv">30,191</span></div>
      <div class="sr"><span class="sn">Unsub Rate</span><span class="sv" style="color:var(--amber)">40.8% of list</span></div>
    </div>
    <div class="card">
      <div class="card-h"><div><div class="card-title">Email List Growth Over Time</div><div class="card-sub">Cumulative new contacts Â· Mar 2020 â€“ Feb 2026</div></div></div>
      <div style="height:180px;position:relative"><canvas id="emailGrowthChart"></canvas></div>
    </div>
  </div>
  <div class="card">
    <div class="card-h"><div><div class="card-title">Monthly New Subscribers vs Estimated Unsubscribes</div><div class="card-sub">Email list momentum Â· Jan 2023 â€“ Feb 2026</div></div></div>
    <div style="height:200px;position:relative"><canvas id="emailTrendChart"></canvas></div>
    <div class="cleg"><div class="leg-i"><div class="leg-d" style="background:#00e5a0"></div>New Contacts</div><div class="leg-i"><div class="leg-d" style="background:#ff4d6d"></div>Est. Unsubscribes</div></div>
  </div>
</section>
</main>

<script>
// â”€â”€â”€ AUTH GATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function(){
  const KEY='bc_auth';
  const gate=document.getElementById('auth-gate');
  if(sessionStorage.getItem(KEY)==='1'){gate.style.display='none';return;}
  // Prevent scroll on body while gate is visible
  document.body.style.overflow='hidden';
})();
function checkAuth(){
  const input=document.getElementById('auth-input');
  const err=document.getElementById('auth-err');
  const box=document.getElementById('auth-box');
  const gate=document.getElementById('auth-gate');
  if(input.value==='roadto3M'){
    sessionStorage.setItem('bc_auth','1');
    gate.classList.add('fade-out');
    document.body.style.overflow='';
    setTimeout(()=>{gate.style.display='none';},520);
  } else {
    err.classList.add('show');
    box.classList.remove('shake');
    void box.offsetWidth; // reflow to restart animation
    box.classList.add('shake');
    input.value='';
    setTimeout(()=>err.classList.remove('show'),2200);
  }
}
function togglePw(){
  const inp=document.getElementById('auth-input');
  inp.type=inp.type==='password'?'text':'password';
}

// â”€â”€â”€ CHART.JS DEFAULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Chart.defaults.color='#6b8199';
Chart.defaults.borderColor='rgba(255,255,255,0.06)';
Chart.defaults.font.family="'DM Sans', sans-serif";
Chart.defaults.font.size=11;

const C={
  green:'#00e5a0',greenA:'rgba(0,229,160,0.2)',
  blue:'#3b9eff',blueA:'rgba(59,158,255,0.18)',
  rose:'#ff4d6d',roseA:'rgba(255,77,109,0.15)',
  amber:'#ffb347',amberA:'rgba(255,179,71,0.15)',
  purple:'#a78bfa',purpleA:'rgba(167,139,250,0.15)',
  cyan:'#22d3ee',cyanA:'rgba(34,211,238,0.12)',
};
const PAL=[C.green,C.blue,C.amber,C.rose,C.purple,C.cyan,'#fb923c','#e879f9'];
const PALA=[C.greenA,C.blueA,C.amberA,C.roseA,C.purpleA,C.cyanA,'rgba(251,146,60,0.15)','rgba(232,121,249,0.15)'];

const fmtN=n=>new Intl.NumberFormat('en-US').format(Math.round(n));
const fmtK=n=>n>=1e6?'$'+(n/1e6).toFixed(1)+'M':n>=1e3?'$'+(n/1e3).toFixed(0)+'K':'$'+Math.round(n);
const fmtM=n=>n>=1e6?'$'+(n/1e6).toFixed(2)+'M':fmtK(n);

function grad(ctx,color,a=0.25,h=260){
  const g=ctx.createLinearGradient(0,0,0,h);
  g.addColorStop(0,color.replace('rgb(','rgba(').replace(')',`, ${a})`));
  g.addColorStop(1,color.replace('rgb(','rgba(').replace(')',', 0)'));
  return g;
}

const tooltipBase={
  backgroundColor:'#0f1929',borderColor:'rgba(255,255,255,0.12)',
  borderWidth:1,titleColor:'#e2eaf5',bodyColor:'#6b8199',padding:10
};

function lineOpts(yFmt='$',y2=false){
  const o={
    responsive:true,maintainAspectRatio:false,
    interaction:{mode:'index',intersect:false},
    plugins:{legend:{display:false},tooltip:{...tooltipBase,callbacks:{
      label(c){
        const v=c.parsed.y;
        if(yFmt==='$')return ` ${c.dataset.label}: ${fmtK(v)}`;
        if(yFmt==='%')return ` ${c.dataset.label}: ${v.toFixed(2)}%`;
        return ` ${c.dataset.label}: ${fmtN(v)}`;
      }
    }}},
    scales:{
      x:{grid:{display:false},ticks:{maxTicksLimit:10,maxRotation:0}},
      y:{grid:{color:'rgba(255,255,255,0.05)'},ticks:{callback:v=>yFmt==='$'?fmtK(v):yFmt==='%'?v+'%':fmtN(v)}}
    }
  };
  if(y2) o.scales.y2={display:true,position:'right',grid:{display:false},ticks:{callback:v=>fmtN(v*1000)}};
  return o;
}

// â”€â”€â”€ ALL MONTHLY DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MD=[
  {m:'2020-03',g:2829,n:2829,o:35,nc:35,rc:0,d:0,r:0,sub:0,ot:35},
  {m:'2020-04',g:5123,n:4712,o:102,nc:100,rc:2,d:411,r:0,sub:18,ot:84},
  {m:'2020-05',g:14514,n:13394,o:337,nc:324,rc:13,d:976,r:144,sub:38,ot:299},
  {m:'2020-06',g:26394,n:25789,o:637,nc:569,rc:68,d:482,r:123,sub:97,ot:540},
  {m:'2020-07',g:54224,n:53181,o:1439,nc:1338,rc:101,d:1018,r:25,sub:181,ot:1258},
  {m:'2020-08',g:60350,n:58855,o:1601,nc:1405,rc:196,d:1394,r:101,sub:243,ot:1358},
  {m:'2020-09',g:49194,n:48353,o:1299,nc:1069,rc:230,d:670,r:171,sub:343,ot:956},
  {m:'2020-10',g:43963,n:43432,o:1120,nc:849,rc:271,d:348,r:183,sub:388,ot:732},
  {m:'2020-11',g:44964,n:42560,o:1152,nc:729,rc:423,d:2365,r:39,sub:368,ot:784},
  {m:'2020-12',g:64315,n:63186,o:1675,nc:1311,rc:364,d:1040,r:89,sub:265,ot:1410},
  {m:'2021-01',g:48475,n:47145,o:1243,nc:956,rc:287,d:1244,r:86,sub:200,ot:1043},
  {m:'2021-02',g:46219,n:45085,o:1222,nc:1027,rc:195,d:1129,r:5,sub:140,ot:1082},
  {m:'2021-03',g:104748,n:101361,o:2398,nc:2055,rc:343,d:3375,r:12,sub:133,ot:2265},
  {m:'2021-04',g:98273,n:94343,o:2077,nc:1775,rc:302,d:3930,r:0,sub:107,ot:1970},
  {m:'2021-05',g:97202,n:91704,o:2135,nc:1752,rc:383,d:5413,r:85,sub:140,ot:1995},
  {m:'2021-06',g:129758,n:121738,o:3019,nc:2653,rc:366,d:8020,r:0,sub:114,ot:2905},
  {m:'2021-07',g:173773,n:160670,o:4034,nc:3569,rc:465,d:13094,r:9,sub:178,ot:3856},
  {m:'2021-08',g:104875,n:100510,o:2447,nc:1985,rc:462,d:4287,r:78,sub:380,ot:2067},
  {m:'2021-09',g:72520,n:67325,o:1496,nc:966,rc:530,d:5034,r:161,sub:325,ot:1171},
  {m:'2021-10',g:52145,n:50177,o:1126,nc:708,rc:418,d:1968,r:0,sub:311,ot:815},
  {m:'2021-11',g:47493,n:40887,o:909,nc:308,rc:601,d:6560,r:46,sub:281,ot:628},
  {m:'2021-12',g:55766,n:52298,o:994,nc:553,rc:441,d:3338,r:130,sub:265,ot:729},
  {m:'2022-01',g:83888,n:79353,o:1619,nc:1205,rc:414,d:4479,r:56,sub:290,ot:1329},
  {m:'2022-02',g:88755,n:84426,o:1955,nc:1603,rc:352,d:4070,r:259,sub:318,ot:1637},
  {m:'2022-03',g:68971,n:64789,o:1599,nc:1157,rc:442,d:2817,r:1365,sub:332,ot:1267},
  {m:'2022-04',g:105672,n:98917,o:2325,nc:1770,rc:555,d:5388,r:1367,sub:369,ot:1956},
  {m:'2022-05',g:102374,n:97878,o:2301,nc:1655,rc:646,d:4116,r:380,sub:505,ot:1796},
  {m:'2022-06',g:86715,n:82465,o:2012,nc:1364,rc:648,d:3932,r:318,sub:382,ot:1630},
  {m:'2022-07',g:80120,n:74129,o:1840,nc:1101,rc:739,d:5765,r:226,sub:485,ot:1355},
  {m:'2022-08',g:80968,n:77263,o:1942,nc:1194,rc:748,d:3393,r:312,sub:498,ot:1444},
  {m:'2022-09',g:78972,n:75124,o:1722,nc:995,rc:727,d:3484,r:364,sub:495,ot:1227},
  {m:'2022-10',g:105420,n:100408,o:2490,nc:1584,rc:906,d:4414,r:598,sub:666,ot:1824},
  {m:'2022-11',g:132846,n:119409,o:2817,nc:1517,rc:1300,d:12548,r:889,sub:951,ot:1866},
  {m:'2022-12',g:116480,n:110189,o:2530,nc:1244,rc:1286,d:5674,r:617,sub:1042,ot:1488},
  {m:'2023-01',g:109678,n:104140,o:2441,nc:1067,rc:1374,d:4351,r:1187,sub:1143,ot:1298},
  {m:'2023-02',g:61199,n:58926,o:1379,nc:217,rc:1162,d:1585,r:688,sub:1002,ot:377},
  {m:'2023-03',g:98738,n:94607,o:1881,nc:805,rc:1076,d:3330,r:801,sub:822,ot:1059},
  {m:'2023-04',g:122290,n:117174,o:2368,nc:1266,rc:1102,d:3763,r:1353,sub:816,ot:1552},
  {m:'2023-05',g:136342,n:132105,o:2659,nc:1181,rc:1478,d:3586,r:651,sub:1133,ot:1526},
  {m:'2023-06',g:167673,n:161072,o:3273,nc:1520,rc:1753,d:4819,r:1782,sub:1289,ot:1984},
  {m:'2023-07',g:200654,n:193647,o:3796,nc:1729,rc:2067,d:5896,r:1111,sub:1527,ot:2269},
  {m:'2023-08',g:216429,n:206720,o:4163,nc:1961,rc:2202,d:7109,r:2600,sub:1669,ot:2494},
  {m:'2023-09',g:244907,n:235709,o:4717,nc:2272,rc:2445,d:8014,r:1184,sub:1772,ot:2945},
  {m:'2023-10',g:246693,n:237043,o:4745,nc:1985,rc:2760,d:7753,r:1897,sub:2137,ot:2608},
  {m:'2023-11',g:414098,n:334348,o:6624,nc:3458,rc:3166,d:77658,r:2092,sub:2195,ot:4429},
  {m:'2023-12',g:357479,n:344595,o:6748,nc:3187,rc:3561,d:11354,r:1530,sub:2795,ot:3953},
  {m:'2024-01',g:495061,n:472601,o:8843,nc:4591,rc:4252,d:20023,r:2437,sub:3264,ot:5579},
  {m:'2024-02',g:434693,n:419361,o:7261,nc:2879,rc:4382,d:13320,r:2012,sub:3443,ot:3818},
  {m:'2024-03',g:544587,n:525649,o:8709,nc:3932,rc:4777,d:15813,r:3125,sub:3796,ot:4913},
  {m:'2024-04',g:597833,n:573259,o:9298,nc:4264,rc:5034,d:20356,r:4218,sub:3974,ot:5324},
  {m:'2024-05',g:573913,n:550378,o:8844,nc:3255,rc:5589,d:17908,r:5627,sub:4531,ot:4313},
  {m:'2024-06',g:478373,n:461468,o:7533,nc:2272,rc:5261,d:11693,r:5212,sub:4445,ot:3088},
  {m:'2024-07',g:559860,n:538814,o:8620,nc:3409,rc:5211,d:17087,r:3959,sub:4418,ot:4202},
  {m:'2024-08',g:1023592,n:970964,o:14682,nc:8742,rc:5940,d:44551,r:8077,sub:4692,ot:9990},
  {m:'2024-09',g:1290840,n:1234718,o:17626,nc:9275,rc:8351,d:44891,r:11231,sub:6445,ot:11181},
  {m:'2024-10',g:1520730,n:1419224,o:20640,nc:10358,rc:10282,d:51792,r:49714,sub:8269,ot:12371},
  {m:'2024-11',g:1444070,n:1354577,o:19573,nc:8576,rc:10997,d:50566,r:38927,sub:9183,ot:10390},
  {m:'2024-12',g:782425,n:759473,o:11389,nc:657,rc:10732,d:9354,r:13598,sub:9603,ot:1786},
  {m:'2025-01',g:983304,n:944470,o:13534,nc:4572,rc:8962,d:28343,r:10491,sub:7243,ot:6291},
  {m:'2025-02',g:1159160,n:1105264,o:15477,nc:6686,rc:8791,d:40812,r:13084,sub:7194,ot:8283},
  {m:'2025-03',g:1246159,n:1189046,o:16755,nc:6104,rc:10651,d:35988,r:21125,sub:9006,ot:7749},
  {m:'2025-04',g:1114125,n:1070380,o:15205,nc:4835,rc:10370,d:24749,r:18996,sub:8513,ot:6692},
  {m:'2025-05',g:1133213,n:1092317,o:15441,nc:5194,rc:10247,d:22516,r:18380,sub:8594,ot:6847},
  {m:'2025-06',g:1048583,n:1010953,o:14179,nc:4437,rc:9742,d:18735,r:18895,sub:8315,ot:5864},
  {m:'2025-07',g:1117826,n:1086177,o:14951,nc:5109,rc:9842,d:22167,r:9482,sub:8449,ot:6502},
  {m:'2025-08',g:1080647,n:1051887,o:14472,nc:4458,rc:10014,d:19020,r:9740,sub:8756,ot:5716},
  {m:'2025-09',g:962708,n:937517,o:13003,nc:3394,rc:9609,d:15346,r:9845,sub:8362,ot:4641},
  {m:'2025-10',g:966777,n:944276,o:13104,nc:3684,rc:9420,d:15791,r:6710,sub:8237,ot:4867},
  {m:'2025-11',g:1044930,n:1019182,o:12670,nc:3518,rc:9152,d:17572,r:8176,sub:7340,ot:5330},
  {m:'2025-12',g:1055085,n:1023848,o:13426,nc:4824,rc:8602,d:23214,r:8023,sub:7447,ot:5979},
  {m:'2026-01',g:1017177,n:981815,o:12309,nc:3542,rc:8767,d:24140,r:11222,sub:7370,ot:4939},
  {m:'2026-02',g:572713,n:547366,o:6780,nc:2262,rc:4518,d:15508,r:9839,sub:3886,ot:2894}
];

// â”€â”€â”€ COUNTRY DATA (from data.js) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COUNTRIES=COUNTRY_TOTALS; // alias â€“ COUNTRY_TOTALS loaded from data.js


// â”€â”€â”€ WEEKLY WoW DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const WK=['Jul 28','Aug 04','Aug 11','Aug 18','Aug 25','Sep 01','Sep 08','Sep 15','Sep 22','Sep 29','Oct 06','Oct 13','Oct 20','Oct 27','Nov 03','Nov 10','Nov 17','Nov 24','Dec 01','Dec 08','Dec 15','Dec 22','Dec 29','Jan 05','Jan 12','Jan 19','Jan 26','Feb 02','Feb 09','Feb 16'];
const CVR_SRC={
  direct:[3.73,3.44,3.95,3.30,3.47,3.58,3.54,3.42,3.39,3.68,3.39,3.74,3.41,3.56,4.10,4.73,3.93,4.51,4.27,2.59,2.91,2.71,3.00,3.02,2.53,2.39,2.38,2.25,1.95,1.87],
  social:[2.03,1.99,2.55,2.51,1.95,2.07,1.78,2.08,2.36,2.00,1.78,2.04,1.78,2.59,2.18,3.00,2.65,2.53,2.40,2.88,2.40,2.39,2.51,2.53,2.34,1.99,2.26,2.03,1.91,1.67],
  search:[6.35,5.75,6.67,5.21,5.38,5.86,4.77,5.57,5.06,5.56,5.01,4.53,4.81,5.54,4.80,7.33,5.74,7.31,6.63,6.58,6.60,6.06,6.22,5.06,4.99,3.91,4.48,4.36,5.87,6.85],
  email:[4.51,3.26,4.66,4.70,6.10,10.13,6.92,6.49,4.90,6.43,5.68,4.40,5.51,6.51,3.78,5.94,7.91,8.70,4.78,3.64,8.19,5.88,6.90,3.91,3.24,4.28,2.28,4.69,3.44,6.03],
  unknown:[4.51,4.25,3.53,3.65,4.08,3.52,5.96,1.61,3.98,3.08,5.36,4.30,4.91,4.18,2.37,3.92,2.64,4.67,3.69,2.51,2.92,1.86,3.26,3.82,4.51,1.59,1.34,4.23,1.45,2.60],
};
const CVR_MED={
  paid:[2.41,2.30,2.75,2.62,2.65,2.50,2.23,2.35,2.50,2.16,2.06,2.21,1.90,2.74,2.43,3.31,2.73,2.71,2.54,2.78,2.38,2.30,2.45,2.38,2.26,1.98,2.19,1.97,1.90,1.76],
  none:[3.79,3.18,3.81,3.75,3.14,3.42,2.92,3.37,3.63,3.46,3.03,2.76,3.36,3.10,3.07,4.06,3.86,4.71,4.28,3.52,3.50,3.66,3.65,3.51,3.18,2.83,3.19,2.93,2.62,2.60],
  email:[5.56,3.83,6.88,3.45,4.56,7.42,6.93,5.27,6.19,7.82,6.25,6.99,5.95,7.15,6.66,8.10,6.73,6.82,7.67,3.40,6.55,5.03,6.51,5.53,3.17,2.75,2.89,2.73,2.28,2.35],
  sms:[6.11,6.25,5.48,3.38,3.74,4.08,6.12,5.39,4.22,4.92,3.48,4.75,4.38,3.44,6.03,6.81,3.74,3.85,5.68,2.63,3.24,4.55,3.30,2.83,2.26,2.48,1.72,2.48,2.59,2.36],
  flow:[7.37,7.69,6.71,8.01,6.98,6.31,5.46,7.92,7.42,6.70,4.97,6.81,4.50,6.59,5.54,7.51,7.77,8.95,6.03,4.23,5.40,4.19,5.92,4.15,3.40,4.26,3.46,5.44,4.73,3.83],
};
const REV_MED={
  paid:[65442,54506,53491,46733,20224,25274,27895,38105,50283,35920,41312,45450,53421,29766,23554,36598,49913,79690,31555,69606,69302,67065,69049,40368,31474,33482,63638,61962,38151,9946],
  email:[9810,7054,10975,12421,5545,6507,8721,7898,9474,7153,8959,8346,9848,4500,4274,5651,7876,14846,5340,6552,7690,3446,8812,7460,3760,4707,4368,3097,626,737],
  sms:[12628,12348,11559,8402,5413,3577,4269,6947,9303,5374,6636,7306,5070,3051,4102,3415,1104,3011,4376,1690,1279,2318,2013,2436,2244,1684,1320,1499,453,116],
  flow:[10340,12156,8585,8954,5039,4534,5797,8022,10978,5908,5034,7135,4977,3108,1786,2666,3524,6946,5045,4632,6113,3612,6109,3544,3877,2973,4904,6265,4531,745],
  none:[225748,186829,198642,176182,96713,85925,89026,126640,158482,109069,91024,103753,106560,62616,53953,86569,104910,146554,68799,97363,96591,65205,84754,52601,41219,18317,23179,21190,12722,3246],
};

// â”€â”€â”€ TRAFFIC BY MEDIUM (session shares from FUNNEL_CHAN â€” measured Shopify analytics) â”€
const _wfS=[48901,42773,35492,40085,23766,23764,28529,35513,42895,37566,41354,38605,42071,25431,21333,29508,39600,49825,29758,45445,52534,50586,54996,38920,34355,37502,56612,56418,42149,14232];
// Per-channel weekly CVR (total, for Total CVR column in weekly table)
const WK_CVR_TOT=[3.11,2.89,3.51,3.16,3.23,3.38,3.04,3.06,3.10,2.93,2.67,2.84,2.58,3.32,3.23,3.95,3.32,3.59,3.46,2.95,2.76,2.65,2.90,2.94,2.62,2.30,2.40,2.25,2.11,2.02];
const TRAF_MED=(()=>{
  // Session shares from FUNNEL_CHAN measured data (paid:2085000, email:142000, sms:83000, flow:211000, all:4297348)
  // Inlined to avoid forward-reference to FUNNEL_CHAN which is declared below
  const sh={paid:0.4852,email:0.03304,sms:0.01932,flow:0.04910};
  sh.none=1-sh.paid-sh.email-sh.sms-sh.flow;
  const result={};
  ['paid','email','sms','flow','none'].forEach(m=>{result[m]=_wfS.map(s=>Math.round(s*sh[m]));});
  return result;
})();

// â”€â”€â”€ COHORT CHANNEL FILTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Approximate proportion of new-customer acquisition by channel
const COHORT_CHAN={all:1.0,paid:0.62,email:0.09,sms:0.06,flow:0.23};
let cohortChannel='all';

// â”€â”€â”€ FUNNEL BY CHANNEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const FUNNEL_CHAN={
  all:{sessions:4297348,cart:8.8,checkout:8.1,cvr:3.42,completed:146874,label:'All channels'},
  paid:{sessions:2085000,cart:8.9,checkout:8.2,cvr:2.63,completed:54895,label:'Paid'},
  email:{sessions:142000,cart:18.5,checkout:17.1,cvr:11.8,completed:16756,label:'Email'},
  sms:{sessions:83000,cart:28.3,checkout:26.1,cvr:15.9,completed:13197,label:'SMS'},
  flow:{sessions:211000,cart:15.8,checkout:14.6,cvr:7.8,completed:16458,label:'Flow'},
};

// â”€â”€â”€ CAMPAIGNS DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// [name, medium, sessions, cartPct, cvr, completed, dateStarted]
const CAMPS_VOLUME=[
  ['US BAU Detox All CBO LC','paid',483369,8.94,2.65,12807,'2024-08'],
  ['(Paid ID) 12755355295','paid',75944,15.59,8.08,6138,'2024-09'],
  ['US Testing ABO','paid',215106,8.04,2.44,5247,'2024-08'],
  ['US ASC Scaling Detox ABO LC','paid',198238,8.04,2.39,4728,'2024-08'],
  ['US BAU Detox All CBO CC','paid',122285,10.49,3.49,4263,'2024-09'],
  ['Welcome Subscribers','sms',24594,32.07,15.87,3903,'2024-06'],
  ['US ASC Detox ABO LC (Copy)','paid',152247,7.76,2.28,3476,'2024-09'],
  ['US BAU CBO LC (Copy)','paid',141392,8.04,2.24,3173,'2024-09'],
  ['US ASC Scaling Detox LC','paid',108587,6.71,2.41,2614,'2024-08'],
  ['US BAU Rest Scaling CBO LC','paid',100265,7.43,2.39,2394,'2024-08'],
  ['Results Quiz','flow',41655,12.70,5.35,2230,'2024-03'],
  ['UK ASC Scaling Detox LC','paid',77491,7.72,2.72,2107,'2024-10'],
  ['US BAU CBO LC - Copy B','paid',74313,8.40,2.59,1925,'2024-09'],
  ['(Paid ID) 120205354305','paid',68046,8.07,2.83,1924,'2024-10'],
  ['(Paid ID) 120205354312','paid',63769,8.13,2.96,1885,'2024-10'],
  ['US Testing ABO Detox','paid',62500,7.90,2.60,1628,'2024-10'],
  ['(Paid ID) 120208057765','paid',45304,7.62,2.90,1312,'2024-11'],
  ['(Paid ID) 22596955813','paid',24932,8.63,4.39,1095,'2024-11'],
  ['EU ASC Scaling Detox LC','paid',71633,5.63,1.43,1025,'2024-10'],
  ['Welcome Email #1','flow',6489,23.04,11.40,740,'2023-06'],
];
const CAMPS_CVR=[
  ['Customer Winback Email 2','flow',408,0,24.02,98,'2024-03'],
  ['Abandoned Cart Email 1','flow',3231,0,21.54,696,'2023-06'],
  ['Abandoned Cart Email 2','flow',2061,0,20.72,427,'2023-06'],
  ['Abandoned Cart Email 3','flow',1586,0,19.74,313,'2023-06'],
  ['Abandoned Cart Email 4','flow',1636,0,18.89,309,'2023-06'],
  ['Abandoned Cart Email 5','flow',2312,0,18.43,426,'2023-06'],
  ['Cart Abandonment SMS','sms',2116,0,16.59,351,'2024-01'],
  ['UPSELL Flow A','flow',302,0,16.23,49,'2024-03'],
  ['UPSELL Flow B','flow',427,0,16.16,69,'2024-03'],
  ['Welcome Subscribers','sms',24594,32.07,15.87,3903,'2024-06'],
  ['Supercharge Metabolism Email','email',417,0,14.87,62,'2024-05'],
  ['Weight Loss Alcohol Email','email',455,0,13.85,63,'2024-07'],
  ['Lorie Review Email','email',384,0,13.80,53,'2024-05'],
  ['Weightloss Flow Email 2','flow',797,0,13.30,106,'2024-02'],
  ['Weightloss Flow Email 1','flow',911,0,13.28,121,'2024-02'],
  ['(Paid ID) 12755355295','paid',75944,15.59,8.08,6138,'2024-09'],
  ['Results Quiz','flow',41655,12.70,5.35,2230,'2024-03'],
  ['US BAU Detox CBO CC','paid',122285,10.49,3.49,4263,'2024-09'],
  ['Welcome Email #1','flow',6489,23.04,11.40,740,'2023-06'],
  ['(Paid ID) 22596955813','paid',24932,8.63,4.39,1095,'2024-11'],
];
let currentCamps=CAMPS_VOLUME;
let campSortCol=2,campSortDir=-1;

// â”€â”€â”€ TIME-BASED COHORT DATA (extracted from CSV) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Rows = customer acquisition month, Cols = subscription order offset M+0..M+12
const COHORT_TIME_REV = {
  '2023-01':[52569,10340,7057,4498,4565,3106,3165,3143,2279,2532,3312,2738,2003],
  '2023-02':[13904,4182,3325,3679,2104,2178,1553,2168,1170,2140,956,1866,1059],
  '2023-03':[49705,15008,11236,7890,5601,5294,4484,4189,5319,2861,3994,2550,3520],
  '2023-04':[68488,22832,13137,9838,7597,5925,5959,7896,4265,4554,4714,3783,4885],
  '2023-05':[63303,22885,14509,11290,8335,7675,8941,5728,5562,4563,5281,4605,4681],
  '2023-06':[81855,28667,17215,11766,9675,9457,6278,5267,5566,4788,5592,5150,4675],
  '2023-07':[98104,29516,19866,13001,13246,8981,7941,6576,6205,5832,5658,4965,4484],
  '2023-08':[108157,34704,23021,19901,12552,11777,8952,8607,7188,8908,6434,6784,6588],
  '2023-09':[122017,39594,31601,17255,15176,11778,10577,9102,8349,6927,5805,6149,6797],
  '2023-10':[109543,41516,23114,16304,13388,12017,10218,9992,8163,7968,8121,8316,8125],
  '2023-11':[224848,58838,44080,28489,22436,19441,18111,13376,11956,11866,13990,12113,13891],
  '2023-12':[180548,65678,40799,31024,22581,19620,16163,13159,14353,15546,14581,12619,12096],
  '2024-01':[273161,87097,63704,42787,34559,27831,24093,23372,21749,24597,19387,17358,17729],
  '2024-02':[188510,67799,44707,33709,25591,19646,17806,17189,17251,14834,12314,11805,10977],
  '2024-03':[268409,91744,52932,36680,26592,23969,21723,21550,17468,14139,14947,12262,13465],
  '2024-04':[294676,106291,62282,49408,37033,33078,29426,22937,19892,20788,18270,19301,16284],
  '2024-05':[224007,79768,54745,40388,31932,26531,20868,16282,16679,14486,13846,11733,12274],
  '2024-06':[145738,60151,40743,30597,25074,18425,13940,14225,11026,9684,9005,10296,7626],
  '2024-07':[229556,94857,61808,45601,32319,24919,23967,18580,19785,17296,15572,12626,12431],
  '2024-08':[644745,246526,154006,97695,64215,57957,45174,41228,36748,34058,30014,27869,25999],
  '2024-09':[714254,270324,155160,94921,73871,55436,48615,43821,35856,31784,27736,25900,22930],
  '2024-10':[796192,278322,154499,115645,82452,73924,60599,52038,43896,41081,35328,32151,31070],
  '2024-11':[670663,207711,134147,89382,75141,60181,52562,41494,38307,33364,25872,26959,26765],
  '2024-12':[61112,21024,11940,11710,8043,7759,5768,5331,4996,3687,3858,3893,4114],
  '2025-01':[362636,144090,100924,64194,50414,39923,32868,29193,24770,21770,23727,18122,17304],
  '2025-02':[538178,199691,114908,80480,60325,49262,41912,33667,27148,27250,22201,22052,10164],
  '2025-03':[492562,162085,97591,64853,50960,41205,32991,28551,28463,23634,24879,9924,0],
  '2025-04':[378494,138308,75152,55506,41452,31774,27955,24868,23016,19369,10205,0,0],
  '2025-05':[404102,146615,81661,59019,43130,35139,30192,27778,22996,10547,0,0,0],
  '2025-06':[350406,140026,87009,60605,46324,37222,31397,27545,11893,0,0,0,0],
  '2025-07':[409616,157767,93696,65338,55342,40559,37107,14389,0,0,0,0,0],
  '2025-08':[350381,136276,82279,60420,41969,36972,17687,0,0,0,0,0,0],
  '2025-09':[263639,105069,64853,41994,36263,15396,0,0,0,0,0,0,0],
  '2025-10':[297348,99221,56757,42577,19210,0,0,0,0,0,0,0,0],
  '2025-11':[337434,105488,61282,22409,0,0,0,0,0,0,0,0,0],
  '2025-12':[407916,141692,48210,0,0,0,0,0,0,0,0,0,0]
};
const COHORT_TIME_ORD = {
  '2023-01':[1070,256,164,101,98,73,70,65,50,56,59,51,46],
  '2023-02':[220,74,50,62,43,36,30,30,27,27,20,26,17],
  '2023-03':[807,277,190,145,107,95,81,70,74,63,64,52,52],
  '2023-04':[1272,472,282,203,153,134,120,126,91,92,84,70,80],
  '2023-05':[1182,470,293,214,167,152,134,117,105,85,100,82,76],
  '2023-06':[1523,577,348,232,200,168,132,109,102,97,100,96,83],
  '2023-07':[1742,604,374,250,205,173,152,118,106,99,88,74,64],
  '2023-08':[1968,691,442,340,250,227,164,148,125,132,98,108,101],
  '2023-09':[2281,797,557,371,323,237,202,170,150,121,105,110,108],
  '2023-10':[1993,737,462,346,263,234,188,167,147,138,131,139,129],
  '2023-11':[3470,1160,833,528,406,344,309,235,201,197,198,188,174],
  '2023-12':[3199,1194,724,561,413,345,282,232,241,245,240,200,188],
  '2024-01':[4610,1430,1052,716,551,444,381,357,325,357,288,251,253],
  '2024-02':[2885,1095,713,547,397,332,301,266,274,230,195,187,169],
  '2024-03':[3934,1376,853,600,446,395,342,335,277,227,213,179,188],
  '2024-04':[4269,1583,953,731,556,483,420,341,305,302,252,273,232],
  '2024-05':[3259,1164,797,590,468,396,310,261,247,198,207,175,166],
  '2024-06':[2273,944,649,489,389,284,221,219,163,147,134,142,109],
  '2024-07':[3409,1462,938,709,500,387,351,281,291,247,229,194,191],
  '2024-08':[8747,3352,2101,1357,934,784,597,561,504,473,396,377,350],
  '2024-09':[9285,3617,2082,1343,1059,764,692,604,509,441,394,360,322],
  '2024-10':[10363,3865,2238,1665,1173,1050,864,750,629,587,514,461,465],
  '2024-11':[8584,3087,1959,1285,1096,875,749,592,536,466,379,381,352],
  '2024-12':[657,272,151,147,100,97,71,72,66,49,53,43,53],
  '2025-01':[4572,2026,1446,936,748,579,482,422,358,329,305,269,239],
  '2025-02':[6690,2707,1593,1094,824,673,581,469,388,366,315,290,132],
  '2025-03':[6106,2236,1369,929,737,584,466,417,383,332,308,140,0],
  '2025-04':[4839,1867,1041,756,585,459,408,345,314,267,137,0,0],
  '2025-05':[5195,1954,1097,811,586,490,406,356,298,131,0,0,0],
  '2025-06':[4439,1857,1124,797,631,489,419,341,151,0,0,0,0],
  '2025-07':[5110,2042,1223,877,687,538,465,183,0,0,0,0,0],
  '2025-08':[4460,1800,1123,800,568,471,220,0,0,0,0,0,0],
  '2025-09':[3394,1389,852,568,434,187,0,0,0,0,0,0,0],
  '2025-10':[3685,1208,721,516,222,0,0,0,0,0,0,0,0],
  '2025-11':[3521,1191,688,261,0,0,0,0,0,0,0,0,0],
  '2025-12':[4825,1616,551,0,0,0,0,0,0,0,0,0,0]
};
const COHORT_MONTHS=['2023-01','2023-02','2023-03','2023-04','2023-05','2023-06','2023-07','2023-08','2023-09','2023-10','2023-11','2023-12','2024-01','2024-02','2024-03','2024-04','2024-05','2024-06','2024-07','2024-08','2024-09','2024-10','2024-11','2024-12','2025-01','2025-02','2025-03','2025-04','2025-05','2025-06','2025-07','2025-08','2025-09','2025-10','2025-11','2025-12'];

let cohortMetric='revenue', cohortMode='abs';

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function heatColor(val,rowMax,type='revenue'){
  if(!val||val===0)return'';
  const r=Math.pow(val/rowMax,0.55);
  const a=0.08+r*0.72;
  const rgb=type==='revenue'?'0,229,160':'59,158,255';
  return`background:rgba(${rgb},${a.toFixed(2)});color:${r>0.45?'rgba(255,255,255,0.95)':'rgba(255,255,255,0.6)'}`;
}

function buildTimeCohort(){
  const data=cohortMetric==='revenue'?(COUNTRY_COHORT_REV[activeCountry]||COUNTRY_COHORT_REV.ALL):(COUNTRY_COHORT_ORD[activeCountry]||COUNTRY_COHORT_ORD.ALL);
  const months=COHORT_MONTHS;
  const scale=COHORT_CHAN[cohortChannel]||1;
  let h='<thead><tr><th>Cohort</th>';
  for(let i=0;i<=12;i++)h+=`<th>M+${i}</th>`;
  h+='</tr></thead><tbody>';
  months.forEach(month=>{
    const rawVals=data[month]||new Array(13).fill(0);
    // In pct mode use rawVals directly â€” scale cancels in division and rounding causes artifacts
    const vals=cohortMode==='pct'?rawVals:rawVals.map(v=>Math.round(v*scale));
    const m0=vals[0]||1;
    const rowMax=Math.max(...vals.filter(v=>v>0));
    h+=`<tr><td>${month}</td>`;
    for(let i=0;i<=12;i++){
      const v=vals[i]||0;
      if(v===0&&i>0){
        h+=`<td style="color:rgba(255,255,255,0.18)">â€”</td>`;
        continue;
      }
      let displayVal,sty='';
      if(cohortMode==='pct'){
        const pct=i===0?100:(m0>0?(v/m0*100):0);
        displayVal=pct>0?(i===0?'100%':pct.toFixed(1)+'%'):'â€”';
        if(pct>0){
          const intensity=Math.min(pct/100,1);
          const a=0.08+intensity*0.72;
          sty=`background:rgba(0,229,160,${a.toFixed(2)});color:${intensity>0.45?'rgba(255,255,255,0.95)':'rgba(255,255,255,0.6)'}`;
        }
      } else {
        displayVal=v===0?'â€”':(cohortMetric==='revenue'?fmtK(v):fmtN(v));
        sty=rowMax>0&&v>0?heatColor(v,rowMax,cohortMetric):'';
      }
      h+=`<td style="${sty}">${displayVal}</td>`;
    }
    h+='</tr>';
  });
  h+='</tbody>';
  document.getElementById('cohortTime').innerHTML=h;
  const titleEl=document.getElementById('cohort-card-title');
  const subEl=document.getElementById('cohort-card-sub');
  if(titleEl) titleEl.textContent=(cohortMetric==='revenue'?'Revenue':'Order')+' Retention Cohort';
  if(subEl) subEl.textContent=(cohortMode==='pct'?'% of M+0 (retention rate)':cohortMetric==='revenue'?'Gross sales':'Order count')+' Â· Jan 2023 â€“ Dec 2024 Â· M+0 = first order, M+1 = 2nd subscription order, etc.';
}

function switchCohortMetric(metric,btn){
  cohortMetric=metric;
  document.querySelectorAll('#cohort-metric-tog .mtog-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  buildTimeCohort();
}

function switchCohortMode(mode,btn){
  cohortMode=mode;
  document.querySelectorAll('#cohort-mode-tog .mtog-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  // Channel filter only meaningful in absolute mode (scale cancels in pct division)
  const chanTog=document.getElementById('cohort-channel-tog');
  const chanNote=document.getElementById('cohort-chan-note');
  if(mode==='pct'){
    chanTog.style.opacity='0.3';
    chanTog.style.pointerEvents='none';
    if(chanNote)chanNote.style.display='inline';
  } else {
    chanTog.style.opacity='';
    chanTog.style.pointerEvents='';
    if(chanNote)chanNote.style.display='none';
  }
  buildTimeCohort();
}

function switchCohortChannel(ch,btn){
  cohortChannel=ch;
  document.querySelectorAll('#cohort-channel-tog .mtog-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  buildTimeCohort();
}

function switchFunnelChannel(ch,btn){
  document.querySelectorAll('#funnel-channel-tog .mtog-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const d=FUNNEL_CHAN[ch]||FUNNEL_CHAN.all;
  const t=d.sessions;
  const cartN=Math.round(t*d.cart/100);
  const coN=Math.round(t*d.checkout/100);
  const cartAband=d.cart>0?((d.cart-d.checkout)/d.cart*100).toFixed(0):0;
  const coAband=coN>0?((coN-d.completed)/coN*100).toFixed(0):0;
  document.getElementById('funnel-sub').textContent=d.label+' Â· Feb 2024 â€“ Feb 2026';
  document.getElementById('funnel-bars').innerHTML=`
    <div style="padding:8px 0">
      <div class="fstep"><div class="flab">Sessions</div><div class="fbar-w"><div class="fbar" style="width:100%;background:linear-gradient(90deg,#3b9eff,#2563eb)">${fmtN(t)}</div></div><div class="fpct">100%</div></div>
      <div class="fstep"><div class="flab">Cart Additions</div><div class="fbar-w"><div class="fbar" style="width:${Math.max(d.cart,0.5)}%;background:linear-gradient(90deg,#00e5a0,#059669)">${fmtN(cartN)}</div></div><div class="fpct">${d.cart.toFixed(1)}%</div></div>
      <div class="fstep"><div class="flab">Reached Checkout</div><div class="fbar-w"><div class="fbar" style="width:${Math.max(d.checkout,0.5)}%;background:linear-gradient(90deg,#ffb347,#d97706)">${fmtN(coN)}</div></div><div class="fpct">${d.checkout.toFixed(1)}%</div></div>
      <div class="fstep"><div class="flab">Completed</div><div class="fbar-w"><div class="fbar" style="width:${Math.max(d.cvr,0.3)}%;background:linear-gradient(90deg,#a78bfa,#7c3aed)">${fmtN(d.completed)}</div></div><div class="fpct">${d.cvr.toFixed(2)}%</div></div>
    </div>
    <div class="sr"><span class="sn">Cart â†’ Checkout drop</span><span class="sv" style="color:var(--amber)">${cartAband}% cart abandonment</span></div>
    <div class="sr"><span class="sn">Checkout â†’ Complete</span><span class="sv" style="color:var(--rose)">${coAband}% abandon at checkout</span></div>
    <div class="sr"><span class="sn">Overall CVR</span><span class="sv">${d.cvr.toFixed(2)}%</span></div>`;
}

// â”€â”€â”€ COUNTRY FILTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let activeCountry='ALL';

function setCountry(c){
  activeCountry=c;
  const d=COUNTRIES[c];
  document.getElementById('k-rev').textContent=fmtM(d.gross);
  document.getElementById('k-ord').textContent=fmtN(d.orders);
  document.getElementById('k-new').textContent=fmtN(d.nc);
  document.getElementById('k-ret').textContent=fmtN(d.rc);
  document.getElementById('k-aov').textContent='$'+d.aov.toFixed(2);
  document.getElementById('k-rr').textContent=d.rr.toFixed(1)+'%';
  document.getElementById('k-dr').textContent=d.dr.toFixed(1)+'%';
  document.getElementById('k-rtr').textContent=d.rtr.toFixed(1)+'%';

  const badge=document.getElementById('filterBadge');
  if(c==='ALL'){badge.style.display='none';}
  else{badge.style.display='inline';badge.textContent=d.flag+' '+d.name;badge.className='badge active-filter';}

  const tag=document.getElementById('country-tag');
  tag.textContent=c==='ALL'?'':'â€” '+d.flag+' '+d.name;

  // Update revenue chart + all other charts
  updateRevenueChart(c);
  updateAllCharts(c);

  // Highlight country card
  document.querySelectorAll('.ctry-card').forEach(el=>{
    el.classList.toggle('sel',el.dataset.curr===c);
  });

  // Update sidebar mini-stat
  document.getElementById('sb-rev').textContent=fmtM(d.gross);
  document.getElementById('sb-orders').textContent=fmtN(d.orders)+' orders';
}

function updateRevenueChart(c){
  const chart=Chart.getChart('revenueChart');
  if(!chart)return;
  const md=COUNTRY_MONTHLY[c]||COUNTRY_MONTHLY.ALL;
  chart.data.labels=md.map(d=>d.m.slice(2,7));
  chart.data.datasets[0].data=md.map(d=>d.g);
  chart.data.datasets[1].data=md.map(d=>d.n);
  if(c==='ALL'){
    document.getElementById('rev-chart-sub').textContent='Full history Â· Mar 2020 â€“ Feb 2026 Â· 5 markets';
  } else {
    const t=COUNTRY_TOTALS[c];
    document.getElementById('rev-chart-sub').textContent=t.flag+' '+t.name+' Â· Mar 2020 â€“ Feb 2026';
  }
  chart.update();
}

// â”€â”€â”€ COUNTRY CHART UPDATE (data-driven) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateAllCharts(country){
  const md=COUNTRY_MONTHLY[country]||COUNTRY_MONTHLY.ALL;
  const rec=md.filter(d=>d.m>='2023-01');

  const drc=Chart.getChart('discReturnsChart');
  if(drc){drc.data.labels=rec.map(d=>d.m.slice(2,7));drc.data.datasets[0].data=rec.map(d=>d.r);drc.data.datasets[1].data=rec.map(d=>d.d);drc.update();}

  const cc=Chart.getChart('custChart');
  if(cc){cc.data.labels=rec.map(d=>d.m.slice(2,7));cc.data.datasets[0].data=rec.map(d=>d.nc);cc.data.datasets[1].data=rec.map(d=>d.rc);cc.update();}

  const ovc=Chart.getChart('ordVolChart');
  if(ovc){ovc.data.labels=rec.map(d=>d.m.slice(2,7));ovc.data.datasets[0].data=rec.map(d=>d.o);ovc.update();}

  const aovc=Chart.getChart('aovChart');
  if(aovc){const f=rec.filter(d=>d.o>10);aovc.data.labels=f.map(d=>d.m.slice(2,7));aovc.data.datasets[0].data=f.map(d=>+(d.g/d.o).toFixed(2));aovc.update();}

  const smc=Chart.getChart('subMixChart');
  if(smc){smc.data.labels=rec.map(d=>d.m.slice(2,7));smc.data.datasets[0].data=rec.map(d=>d.nc);smc.data.datasets[1].data=rec.map(d=>d.rc);smc.update();}

  const sdc=Chart.getChart('subDonutChart');
  if(sdc){const sd=COUNTRY_SUB_DONUT[country]||COUNTRY_SUB_DONUT.ALL;sdc.data.datasets[0].data=[sd.sub,sd.ot];sdc.update();}

  const src=Chart.getChart('subRetChart');
  if(src){src.data.datasets[0].data=[...(COUNTRY_SUB_RET[country]||COUNTRY_SUB_RET.ALL)];src.update();}

  const egc=Chart.getChart('emailGrowthChart');
  if(egc){let cum=0;const g=md.map(d=>(cum+=d.nc,cum));egc.data.labels=md.map(d=>d.m.slice(2,7));egc.data.datasets[0].data=g;egc.update();}

  const etc=Chart.getChart('emailTrendChart');
  if(etc){let cl=md.filter(d=>d.m<'2023-01').reduce((s,d)=>s+d.nc,0);const u=rec.map(d=>{const v=Math.round(d.nc*0.12+cl*0.008);cl+=d.nc;return v;});etc.data.labels=rec.map(d=>d.m.slice(2,7));etc.data.datasets[0].data=rec.map(d=>d.nc);etc.data.datasets[1].data=u;etc.update();}

  buildTimeCohort();
}

// â”€â”€â”€ BUILD COUNTRY CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildCountryCards(){
  const grid=document.getElementById('ctry-grid');
  const keys=Object.keys(COUNTRIES).filter(k=>k!=='ALL');
  grid.innerHTML=keys.map(k=>{
    const d=COUNTRIES[k];
    return`<div class="ctry-card" data-curr="${k}" onclick="document.getElementById('countryFilter').value='${k}';setCountry('${k}')">
      <div class="ctry-flag">${d.flag}</div>
      <div class="ctry-name">${d.name} <span style="font-size:10px;font-weight:400;color:var(--muted)">(${k})</span></div>
      <div class="ctry-row"><span class="ctry-k">Revenue</span><span class="ctry-v" style="color:var(--green)">${fmtM(d.gross)}</span></div>
      <div class="ctry-row"><span class="ctry-k">Orders</span><span class="ctry-v">${fmtN(d.orders)}</span></div>
      <div class="ctry-row"><span class="ctry-k">AOV</span><span class="ctry-v">$${d.aov.toFixed(2)}</span></div>
      <div class="ctry-row"><span class="ctry-k">Ret. Rate</span><span class="ctry-v" style="color:${d.rr>60?'var(--green)':'var(--amber)'}">${d.rr}%</span></div>
      <div class="ctry-row"><span class="ctry-k">Return Rate</span><span class="ctry-v" style="color:${d.rtr>7?'var(--rose)':'var(--muted)'}">${d.rtr}%</span></div>
    </div>`;
  }).join('');
}

// â”€â”€â”€ WoW CHART FILTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function filterChartByKey(chartId,dataMap,key,tabsId,btn){
  document.querySelectorAll(`#${tabsId} .ftab`).forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const chart=Chart.getChart(chartId);
  if(!chart)return;
  chart.data.datasets.forEach(ds=>{
    ds.hidden=key!=='ALL'&&ds.key!==key;
  });
  chart.update();
}
function filterMedChart(k,btn){filterChartByKey('wowMedChart',CVR_MED,k,'med-tabs',btn);}
function filterRevMedChart(k,btn){filterChartByKey('wowRevMedChart',REV_MED,k,'rev-med-tabs',btn);}
function filterTrafChart(k,btn){filterChartByKey('wowTrafChart',TRAF_MED,k,'traf-tabs',btn);}

function buildWeeklyTable(){
  const CHANS=['paid','email','sms','flow','none'];
  const LABELS={paid:'Paid',email:'Email',sms:'SMS',flow:'Flow',none:'Direct / None'};
  const COLORS={paid:'c-paid',email:'c-email',sms:'c-sms',flow:'c-flow',none:'c-none'};

  // â”€â”€ header row 1: channel group labels â”€â”€
  let h='<thead><tr>';
  h+='<th class="wt-sticky" rowspan="2">Week</th>';
  for(const c of CHANS) h+=`<th colspan="4" class="wt-grp-h ${COLORS[c]}">${LABELS[c]}</th>`;
  h+='<th colspan="4" class="wt-grp-h c-total">Total</th>';
  h+='</tr>';
  // â”€â”€ header row 2: metric sub-labels â”€â”€
  h+='<tr>';
  for(let g=0;g<CHANS.length+1;g++){
    h+='<th class="wt-grp-h">Traffic</th><th>CVR%</th><th>Orders</th><th>Revenue</th>';
  }
  h+='</tr></thead><tbody>';

  // â”€â”€ data rows â€” sessions & CVR come from WEEKLY_CHAN[c].s/.cvr (referrer CSV data) â”€â”€
  WEEKLY_CHAN.forEach(w=>{
    h+=`<tr><td class="wt-sticky">${w.w}</td>`;
    let sumO=0,sumR=0,sumS=0;
    for(const c of CHANS){
      const s=w[c].s||0, cvr=w[c].cvr||0;
      const o=w[c].o, r=w[c].r;
      sumO+=o; sumR+=r; sumS+=s;
      const noData=s===0;
      h+=`<td class="wt-gl${noData?' wt-na':''}">${noData?'â€”':fmtN(s)}</td>`;
      h+=`<td class="${noData?'wt-na':''}">${noData?'â€”':cvr.toFixed(1)+'%'}</td>`;
      h+=`<td>${fmtN(o)}</td>`;
      h+=`<td class="wt-rev">${fmtK(r)}</td>`;
    }
    // Total columns: sum sessions across channels, weighted-avg CVR
    const totCvr=sumS>0?CHANS.reduce((s,c)=>(w[c].s||0)*(w[c].cvr||0)+s,0)/sumS:0;
    h+=`<td class="wt-gl${sumS===0?' wt-na':''}">${sumS?fmtN(sumS):'â€”'}</td>`;
    h+=`<td class="${sumS===0?'wt-na':''}">${sumS?totCvr.toFixed(1)+'%':'â€”'}</td>`;
    h+=`<td>${fmtN(sumO)}</td>`;
    h+=`<td class="wt-rev">${fmtK(sumR)}</td>`;
    h+='</tr>';
  });
  h+='</tbody>';
  document.getElementById('weeklyTable').innerHTML=h;
}

// â”€â”€â”€ CAMPAIGNS TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchCampView(type,btn){
  document.querySelectorAll('#attribution .mtog-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  currentCamps=type==='volume'?CAMPS_VOLUME:CAMPS_CVR;
  campSortCol=type==='volume'?2:4;
  campSortDir=-1;
  renderCampTable();
}
function sortCamp(col){
  if(campSortCol===col)campSortDir*=-1;
  else{campSortCol=col;campSortDir=-1;}
  document.querySelectorAll('#campTable th').forEach((th,i)=>{
    th.className=i===col?'sorted':'';
  });
  renderCampTable();
}
function renderCampTable(){
  const sorted=[...currentCamps].sort((a,b)=>{
    const va=a[campSortCol],vb=b[campSortCol];
    return typeof va==='string'?va.localeCompare(vb)*campSortDir:(vb-va)*Math.sign(campSortDir)*-1;
  });
  const medColors={paid:'var(--blue)',sms:'var(--purple)',flow:'var(--green)',email:'var(--amber)',organic:'var(--cyan)'};
  document.getElementById('campTbody').innerHTML=sorted.map(r=>{
    const cvr=r[4];
    const cvrColor=cvr>10?'var(--green)':cvr>5?'var(--amber)':'var(--muted)';
    const medC=medColors[r[1]]||'var(--muted)';
    return`<tr>
      <td style="max-width:260px;overflow:hidden;text-overflow:ellipsis">${r[0]}</td>
      <td><span class="td-pill" style="background:${medC}20;color:${medC}">${r[1]}</span></td>
      <td class="td-mono">${fmtN(r[2])}</td>
      <td class="td-mono">${r[3]?r[3].toFixed(1)+'%':'â€”'}</td>
      <td class="td-mono" style="color:${cvrColor};font-weight:600">${cvr.toFixed(2)}%</td>
      <td class="td-mono" style="color:var(--green)">${fmtN(r[5])}</td>
      <td class="td-mono" style="color:var(--muted)">${r[6]||'â€”'}</td>
    </tr>`;
  }).join('');
}

// â”€â”€â”€ BUILD WoW LINE CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildWoWChart(canvasId,dataMap,yFmt,legendId){
  const ctx=document.getElementById(canvasId).getContext('2d');
  const keys=Object.keys(dataMap);
  const datasets=keys.map((k,i)=>({
    key:k,
    label:k.charAt(0).toUpperCase()+k.slice(1),
    data:dataMap[k],
    borderColor:PAL[i%PAL.length],
    backgroundColor:'transparent',
    borderWidth:2,pointRadius:0,pointHoverRadius:4,tension:0.3,
  }));
  // Legend
  if(legendId){
    document.getElementById(legendId).innerHTML=keys.map((k,i)=>`<div class="leg-i"><div class="leg-d" style="background:${PAL[i%PAL.length]}"></div>${k.charAt(0).toUpperCase()+k.slice(1)}</div>`).join('');
  }
  return new Chart(ctx,{
    type:'line',
    data:{labels:WK,datasets},
    options:{
      responsive:true,maintainAspectRatio:false,
      interaction:{mode:'index',intersect:false},
      plugins:{legend:{display:false},tooltip:{...tooltipBase,callbacks:{
        label(c){const v=c.parsed.y;return` ${c.dataset.label}: ${yFmt==='%'?v.toFixed(2)+'%':yFmt==='n'?fmtN(v):fmtK(v)}`;}
      }}},
      scales:{
        x:{grid:{display:false},ticks:{maxTicksLimit:10,maxRotation:0}},
        y:{grid:{color:'rgba(255,255,255,0.05)'},ticks:{callback:v=>yFmt==='%'?v+'%':yFmt==='n'?fmtN(v):fmtK(v)}}
      }
    }
  });
}

// â”€â”€â”€ CHARTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('load',()=>{
  buildCountryCards();
  renderCampTable();
  buildTimeCohort();
  initCharts();
  initScrollSpy();
});

function initCharts(){
  // 1. Revenue trend
  (()=>{
    const ctx=document.getElementById('revenueChart').getContext('2d');
    const gG=ctx.createLinearGradient(0,0,0,260);gG.addColorStop(0,'rgba(0,229,160,0.22)');gG.addColorStop(1,'rgba(0,229,160,0)');
    const gB=ctx.createLinearGradient(0,0,0,260);gB.addColorStop(0,'rgba(59,158,255,0.18)');gB.addColorStop(1,'rgba(59,158,255,0)');
    new Chart(ctx,{type:'line',data:{labels:COUNTRY_MONTHLY.ALL.map(d=>d.m.slice(2,7)),datasets:[
      {label:'Gross',data:COUNTRY_MONTHLY.ALL.map(d=>d.g),borderColor:C.green,backgroundColor:gG,borderWidth:2,pointRadius:0,fill:true,tension:0.3},
      {label:'Net',data:COUNTRY_MONTHLY.ALL.map(d=>d.n),borderColor:C.blue,backgroundColor:gB,borderWidth:2,pointRadius:0,fill:true,tension:0.3},
    ]},options:lineOpts('$')});
  })();

  // 2. Discounts & Returns
  (()=>{
    const ctx=document.getElementById('discReturnsChart').getContext('2d');
    const rec=COUNTRY_MONTHLY.ALL.filter(d=>d.m>='2023-01');
    new Chart(ctx,{type:'line',data:{labels:rec.map(d=>d.m.slice(2,7)),datasets:[
      {label:'Returns',data:rec.map(d=>d.r),borderColor:C.rose,backgroundColor:'rgba(255,77,109,0.1)',borderWidth:1.5,pointRadius:0,fill:true,tension:0.3},
      {label:'Discounts',data:rec.map(d=>Math.abs(d.d)),borderColor:C.amber,backgroundColor:'rgba(255,179,71,0.1)',borderWidth:1.5,pointRadius:0,fill:true,tension:0.3},
    ]},options:lineOpts('$')});
  })();

  // 3. Customers stacked bar
  (()=>{
    const ctx=document.getElementById('custChart').getContext('2d');
    const rec=COUNTRY_MONTHLY.ALL.filter(d=>d.m>='2023-01');
    new Chart(ctx,{type:'bar',data:{labels:rec.map(d=>d.m.slice(2,7)),datasets:[
      {label:'New',data:rec.map(d=>d.nc),backgroundColor:'rgba(0,229,160,0.75)',borderRadius:2,borderSkipped:false},
      {label:'Returning',data:rec.map(d=>d.rc),backgroundColor:'rgba(59,158,255,0.55)',borderRadius:2,borderSkipped:false},
    ]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{display:false},tooltip:tooltipBase},scales:{x:{stacked:true,grid:{display:false},ticks:{maxTicksLimit:14,maxRotation:0}},y:{stacked:true,grid:{color:'rgba(255,255,255,0.05)'},ticks:{callback:v=>fmtN(v)}}}}});
  })();

  // 4. Order Volume
  (()=>{
    const ctx=document.getElementById('ordVolChart').getContext('2d');
    const rec=COUNTRY_MONTHLY.ALL.filter(d=>d.m>='2023-01');
    const gP=ctx.createLinearGradient(0,0,0,200);gP.addColorStop(0,'rgba(167,139,250,0.28)');gP.addColorStop(1,'rgba(167,139,250,0.02)');
    new Chart(ctx,{type:'line',data:{labels:rec.map(d=>d.m.slice(2,7)),datasets:[{label:'Orders',data:rec.map(d=>d.o),borderColor:C.purple,backgroundColor:gP,borderWidth:2,pointRadius:0,fill:true,tension:0.3}]},options:lineOpts('')});
  })();

  // 5. AOV
  (()=>{
    const ctx=document.getElementById('aovChart').getContext('2d');
    const rec=COUNTRY_MONTHLY.ALL.filter(d=>d.m>='2023-01'&&d.o>100);
    const gA=ctx.createLinearGradient(0,0,0,200);gA.addColorStop(0,'rgba(255,179,71,0.25)');gA.addColorStop(1,'rgba(255,179,71,0.02)');
    new Chart(ctx,{type:'line',data:{labels:rec.map(d=>d.m.slice(2,7)),datasets:[{label:'AOV',data:rec.map(d=>+(d.g/d.o).toFixed(2)),borderColor:C.amber,backgroundColor:gA,borderWidth:2,pointRadius:0,fill:true,tension:0.3}]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{display:false},tooltip:{...tooltipBase,callbacks:{label(c){return` AOV: $${c.parsed.y.toFixed(2)}`;}}}},scales:{x:{grid:{display:false},ticks:{maxTicksLimit:10,maxRotation:0}},y:{grid:{color:'rgba(255,255,255,0.05)'},ticks:{callback:v=>'$'+v},min:40}}}});
  })();

  // 6. Sub mix
  (()=>{
    const ctx=document.getElementById('subMixChart').getContext('2d');
    const sdMD=COUNTRY_MONTHLY.ALL.filter(d=>d.m>='2023-01');
    new Chart(ctx,{type:'bar',data:{labels:sdMD.map(d=>d.m.slice(2,7)),datasets:[
      {label:'New',data:sdMD.map(d=>d.nc),backgroundColor:'rgba(0,229,160,0.75)',borderRadius:2,borderSkipped:false},
      {label:'Renewal',data:sdMD.map(d=>d.rc),backgroundColor:'rgba(59,158,255,0.45)',borderRadius:2,borderSkipped:false},
    ]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{display:false},tooltip:tooltipBase},scales:{x:{stacked:true,grid:{display:false},ticks:{maxRotation:0}},y:{stacked:true,grid:{color:'rgba(255,255,255,0.05)'},ticks:{callback:v=>fmtN(v)}}}}});
  })();

  // 7. Sub donut
  (()=>{
    const ctx=document.getElementById('subDonutChart').getContext('2d');
    new Chart(ctx,{type:'doughnut',data:{labels:['Subscription','One-Time'],datasets:[{data:[COUNTRY_SUB_DONUT.ALL.sub,COUNTRY_SUB_DONUT.ALL.ot],backgroundColor:['rgba(0,229,160,0.85)','rgba(59,158,255,0.7)'],borderColor:['#0f1929'],borderWidth:3,hoverOffset:8}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{...tooltipBase,callbacks:{label(c){return` ${c.label}: ${fmtN(c.parsed)} orders`;}}},cutout:'65%'}}});
  })();

  // 8. Sub retention
  (()=>{
    const ctx=document.getElementById('subRetChart').getContext('2d');
    const vals=[...COUNTRY_SUB_RET.ALL];
    new Chart(ctx,{type:'bar',data:{labels:['1st','#2','#3','#4','#5','#6','#7','#8+'],datasets:[{label:'Orders',data:vals,backgroundColor:vals.map((_,i)=>`rgba(0,229,160,${0.9-i*0.1})`),borderRadius:4,borderSkipped:false}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{...tooltipBase,callbacks:{label(c){return` Orders: ${fmtN(c.parsed.y)}`;}}}},scales:{x:{grid:{display:false}},y:{grid:{color:'rgba(255,255,255,0.05)'},ticks:{callback:v=>fmtN(v)}}}}});
  })();

  // 9. WoW CVR by Medium
  buildWoWChart('wowMedChart',CVR_MED,'%','wow-med-legend');

  // 14. WoW Revenue by Medium
  buildWoWChart('wowRevMedChart',REV_MED,'$','wow-rev-legend');

  // 14b. Weekly Traffic by Medium
  buildWoWChart('wowTrafChart',TRAF_MED,'n','wow-traf-legend');

  // 14c. Weekly channel metrics table
  buildWeeklyTable();

  // 18. CVR Trend + sessions
  (()=>{
    const wf=[{w:'Jul 28',cvr:3.11,s:48901},{w:'Aug 04',cvr:2.89,s:42773},{w:'Aug 11',cvr:3.51,s:35492},{w:'Aug 18',cvr:3.16,s:40085},{w:'Aug 25',cvr:3.23,s:23766},{w:'Sep 01',cvr:3.38,s:23764},{w:'Sep 08',cvr:3.04,s:28529},{w:'Sep 15',cvr:3.06,s:35513},{w:'Sep 22',cvr:3.10,s:42895},{w:'Sep 29',cvr:2.93,s:37566},{w:'Oct 06',cvr:2.67,s:41354},{w:'Oct 13',cvr:2.84,s:38605},{w:'Oct 20',cvr:2.58,s:42071},{w:'Oct 27',cvr:3.32,s:25431},{w:'Nov 03',cvr:3.23,s:21333},{w:'Nov 10',cvr:3.95,s:29508},{w:'Nov 17',cvr:3.32,s:39600},{w:'Nov 24',cvr:3.59,s:49825},{w:'Dec 01',cvr:3.46,s:29758},{w:'Dec 08',cvr:2.95,s:45445},{w:'Dec 15',cvr:2.76,s:52534},{w:'Dec 22',cvr:2.65,s:50586},{w:'Dec 29',cvr:2.90,s:54996},{w:'Jan 05',cvr:2.94,s:38920},{w:'Jan 12',cvr:2.62,s:34355},{w:'Jan 19',cvr:2.30,s:37502},{w:'Jan 26',cvr:2.40,s:56612},{w:'Feb 02',cvr:2.25,s:56418},{w:'Feb 09',cvr:2.11,s:42149},{w:'Feb 16',cvr:2.02,s:14232}];
    const ctx=document.getElementById('cvrTrendChart').getContext('2d');
    const gG=ctx.createLinearGradient(0,0,0,210);gG.addColorStop(0,'rgba(0,229,160,0.2)');gG.addColorStop(1,'rgba(0,229,160,0)');
    new Chart(ctx,{type:'line',data:{labels:wf.map(d=>d.w),datasets:[
      {label:'CVR %',data:wf.map(d=>d.cvr),borderColor:C.green,backgroundColor:gG,borderWidth:2,pointRadius:0,fill:true,tension:0.3,yAxisID:'y'},
      {label:'Sessions (K)',data:wf.map(d=>d.s/1000),borderColor:'rgba(59,158,255,0.4)',borderWidth:1.5,pointRadius:0,fill:false,tension:0.3,yAxisID:'y2'},
    ]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{display:false},tooltip:{...tooltipBase,callbacks:{label(c){return c.datasetIndex===0?` CVR: ${c.parsed.y.toFixed(2)}%`:` Sessions: ${fmtN(c.parsed.y*1000)}`;}}}},scales:{x:{grid:{display:false},ticks:{maxTicksLimit:10,maxRotation:0}},y:{grid:{color:'rgba(255,255,255,0.05)'},ticks:{callback:v=>v+'%'},min:1.5,max:4.5},y2:{display:true,position:'right',grid:{display:false},ticks:{callback:v=>fmtN(v*1000)}}}}});
  })();

  // 19. Email health
  (()=>{
    const ctx=document.getElementById('emailChart').getContext('2d');
    new Chart(ctx,{type:'doughnut',data:{labels:['Subscribed','Unsubscribed','Not Subscribed'],datasets:[{data:[280235,171493,24499],backgroundColor:['rgba(0,229,160,0.85)','rgba(255,77,109,0.75)','rgba(59,158,255,0.6)'],borderColor:['#0f1929'],borderWidth:3,hoverOffset:6}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{...tooltipBase,callbacks:{label(c){return` ${c.label}: ${fmtN(c.parsed)}`;}}},cutout:'60%'}}});
  })();

  // 20. Email list growth (cumulative nc)
  (()=>{
    const ctx=document.getElementById('emailGrowthChart').getContext('2d');
    let cum=0;
    const growthData=COUNTRY_MONTHLY.ALL.map(d=>(cum+=d.nc,cum));
    const gG=ctx.createLinearGradient(0,0,0,180);gG.addColorStop(0,'rgba(0,229,160,0.22)');gG.addColorStop(1,'rgba(0,229,160,0)');
    new Chart(ctx,{type:'line',data:{labels:COUNTRY_MONTHLY.ALL.map(d=>d.m.slice(2,7)),datasets:[{label:'Total List',data:growthData,borderColor:C.green,backgroundColor:gG,borderWidth:2,pointRadius:0,fill:true,tension:0.3}]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{display:false},tooltip:{...tooltipBase,callbacks:{label(c){return` List size: ${fmtN(c.parsed.y)}`;}}},scales:{x:{grid:{display:false},ticks:{maxTicksLimit:10,maxRotation:0}},y:{grid:{color:'rgba(255,255,255,0.05)'},ticks:{callback:v=>fmtN(v)}}}}}});
  })();

  // 21. Email new subscribers vs estimated unsubscribes
  (()=>{
    const ctx=document.getElementById('emailTrendChart').getContext('2d');
    const rec=COUNTRY_MONTHLY.ALL.filter(d=>d.m>='2023-01');
    // Estimated unsubscribes: ~15% of new contacts + ~1% monthly churn on existing list
    let cumList=COUNTRY_MONTHLY.ALL.filter(d=>d.m<'2023-01').reduce((s,d)=>s+d.nc,0);
    const unsubs=rec.map(d=>{const u=Math.round(d.nc*0.12+cumList*0.008);cumList+=d.nc;return u;});
    new Chart(ctx,{type:'bar',data:{labels:rec.map(d=>d.m.slice(2,7)),datasets:[
      {label:'New Contacts',data:rec.map(d=>d.nc),backgroundColor:'rgba(0,229,160,0.7)',borderRadius:2,borderSkipped:false},
      {label:'Est. Unsubscribes',data:unsubs,backgroundColor:'rgba(255,77,109,0.6)',borderRadius:2,borderSkipped:false},
    ]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{display:false},tooltip:{...tooltipBase,callbacks:{label(c){return` ${c.dataset.label}: ${fmtN(c.parsed.y)}`;}}},scales:{x:{grid:{display:false},ticks:{maxRotation:0,maxTicksLimit:14}},y:{grid:{color:'rgba(255,255,255,0.05)'},ticks:{callback:v=>fmtN(v)}}}}}});
  })();

}

// â”€â”€â”€ SCROLL SPY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initScrollSpy(){
  const sections=document.querySelectorAll('.section');
  const navItems=document.querySelectorAll('.ni');
  const obs=new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        const id=e.target.id;
        navItems.forEach(n=>n.classList.toggle('active',n.getAttribute('href')==='#'+id));
      }
    });
  },{rootMargin:'-25% 0px -65% 0px',threshold:0});
  sections.forEach(s=>obs.observe(s));
}
</script>
</body>
</html>
